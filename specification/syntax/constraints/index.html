<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><script type=text/javascript src=/module/hugo-uswds/js/uswds-init.min.js></script><link rel=preload href=/module/hugo-uswds/js/uswds.min.js as=script><link rel=stylesheet href=/module/hugo-uswds/css/styles.css><title>Constraints</title>
<script type=text/javascript src=/module/hugo-uswds/js/jquery.min.js></script><script type=text/javascript defer src=/module/hugo-uswds/js/hugo-uswds.min.js></script></head><body><div class=usa-overlay></div><header class="usa-header usa-header--extended site-header"><div class="usa-navbar site-header__navbar"><div id=extended-logo class="usa-logo site-logo"><a class="usa-logo__text site-logo__text" href=/ title="Metaschema Information Modeling Framework" aria-label=Home><em><span class=site-title--short>Metaschema</span>
<span class=site-title--long>Metaschema Information Modeling Framework</span></em></a></div><div class="site-nav-secondary usa-nav__secondary"><ul class=usa-nav__secondary-links><li class=usa-nav__secondary-item><a href=/contribute/contact/>Contact Us</a></li><li class=usa-nav__secondary-item><a href=/contribute/>Get involved</a></li><li class=usa-nav__secondary-item><a href=https://github.com/metaschema-framework/metaschema>Github</a></li></ul><section aria-label="Search component"><form class="usa-search usa-search--small" role=search action=https://search.usa.gov/search><input id=affiliate name=affiliate type=hidden>
<input name=utf8 type=hidden value=&#x2713;>
<label class=usa-sr-only for=search-field-en-small>Search</label>
<input class=usa-input id=search-field-en-small type=search name=query>
<button class=usa-button type=submit><img src=/module/hugo-uswds/img/usa-icons-bg/search--white.svg class=usa-search__submit-icon alt=Search></button></form></section></div><button class=usa-menu-btn>Menu</button></div></header><nav class="site-nav usa-nav sticky" aria-label="Primary navigation"><div class="usa-nav__inner site-nav__inner"><button class=usa-nav__close><img src=/module/hugo-uswds/img/usa-icons/close.svg role=img alt=close></button><ul class="usa-nav__primary usa-accordion"><li class=usa-nav__primary-item><a class=usa-nav__link href=/specification/><span>Specification</span></a></li><li class=usa-nav__primary-item><a class=usa-nav__link href=/tutorials/><span>Tutorials</span></a></li><li class=usa-nav__primary-item><a class=usa-nav__link href=/use/><span>Using</span></a></li><li class=usa-nav__primary-item><a class=usa-nav__link href=/contribute/><span>Contribute</span></a></li></ul></div></nav><div class=site-content-container><aside id=page-side-navigation class="sidenav site-sidenav" aria-label="Section navigation"><nav aria-label="Secondary navigation"><ul class=usa-sidenav><li class="usa-sidenav__item section usa-subnav__top-level"><a href=/specification/>Metaschema Specification</a><ul class=usa-sidenav__sublist><li class="usa-sidenav__item page"><a href=/specification/overview/>Overview</a></li><li class="usa-sidenav__item page"><a href=/specification/information-modeling/>Information Modeling</a></li><li class="usa-sidenav__item section"><a href=/specification/syntax/>Syntax</a><ul class=usa-sidenav__sublist><li class="usa-sidenav__item page"><a href=/specification/syntax/module/>Module</a></li><li class="usa-sidenav__item page"><a href=/specification/syntax/definitions/>Definitions</a></li><li class="usa-sidenav__item page"><a href=/specification/syntax/instances/>Instances</a></li><li class="usa-sidenav__item page"><a href=/specification/syntax/inline-definitions/>Inline Definitions</a></li><li class="usa-sidenav__item page"><a class=usa-current href=/specification/syntax/constraints/>Constraints</a></li><li class="usa-sidenav__item page"><a href=/specification/syntax/metapath/>Metapath Expression Language</a></li><li class="usa-sidenav__item page"><a href=/specification/syntax/metapath-overview/>Metapath vs. XPath</a></li></ul></li><li class="usa-sidenav__item page"><a href=/specification/mapping/>Format Bindings</a></li><li class="usa-sidenav__item page"><a href=/specification/datatypes/>Data Types</a></li><li class="usa-sidenav__item page"><a href=/specification/glossary/>Glossary</a></li></ul></li></ul></nav></aside><div class=usa-in-page-nav-container><aside class=site-in-page-nav aria-label="On this page" data-heading-selectors="h2, h3, h4, h5, h6" data-scroll-offset=-120 data-root-margin="48px 0px -90% 0px" data-threshold=1><nav class=usa-in-page-nav__nav aria-label="On this page"><h4 class=usa-in-page-nav__heading tabindex=0>On this page</h4><ul class=usa-in-page-nav__list><li class=usa-in-page-nav__item><a href=#define-flag-constraints class="site-in-page-nav__link h2"><code>&lt;define-flag></code> constraints</a></li><li class=usa-in-page-nav__item><a href=#define-field-constraints class="site-in-page-nav__link h2"><code>&lt;define-field></code> constraints</a></li><li class=usa-in-page-nav__item><a href=#define-assembly-constraints class="site-in-page-nav__link h2"><code>&lt;define-assembly></code> constraints</a></li><li class=usa-in-page-nav__item><a href=#common-constraint-data class="site-in-page-nav__link h2">Common Constraint Data</a></li><li class="usa-in-page-nav__item usa-in-page-nav__item--sub-item"><a href=#id class="site-in-page-nav__link h3"><code>@id</code></a></li><li class="usa-in-page-nav__item usa-in-page-nav__item--sub-item"><a href=#level class="site-in-page-nav__link h3"><code>@level</code></a></li><li class="usa-in-page-nav__item usa-in-page-nav__item--sub-item"><a href=#target class="site-in-page-nav__link h3"><code>@target</code></a></li><li class="usa-in-page-nav__item usa-in-page-nav__item--sub-item"><a href=#deprecated-version class="site-in-page-nav__link h3"><code>@deprecated</code> Version</a></li><li class="usa-in-page-nav__item usa-in-page-nav__item--sub-item"><a href=#name class="site-in-page-nav__link h3"><code>@name</code></a></li><li class="usa-in-page-nav__item usa-in-page-nav__item--sub-item"><a href=#scope class="site-in-page-nav__link h3"><code>@scope</code></a></li><li class="usa-in-page-nav__item usa-in-page-nav__item--sub-item"><a href=#formal-name class="site-in-page-nav__link h3"><code>&lt;formal-name></code></a></li><li class="usa-in-page-nav__item usa-in-page-nav__item--sub-item"><a href=#description class="site-in-page-nav__link h3"><code>&lt;description></code></a></li><li class="usa-in-page-nav__item usa-in-page-nav__item--sub-item"><a href=#prop class="site-in-page-nav__link h3"><code>&lt;prop></code></a></li><li class="usa-in-page-nav__item usa-in-page-nav__item--sub-item"><a href=#remarks class="site-in-page-nav__link h3"><code>&lt;remarks></code></a></li><li class=usa-in-page-nav__item><a href=#metapath-expressions-in-constraints class="site-in-page-nav__link h2">Metapath Expressions in Constraints</a></li><li class="usa-in-page-nav__item usa-in-page-nav__item--sub-item"><a href=#metapath-accepting-attributes class="site-in-page-nav__link h3">Metapath-Accepting Attributes</a></li><li class="usa-in-page-nav__item usa-in-page-nav__item--sub-item"><a href=#evaluation-focus class="site-in-page-nav__link h3">Evaluation Focus</a></li><li class=usa-in-page-nav__item><a href=#constraint-types class="site-in-page-nav__link h2">Constraint Types</a></li><li class="usa-in-page-nav__item usa-in-page-nav__item--sub-item"><a href=#let-expressions class="site-in-page-nav__link h3"><code>let</code> Expressions</a></li><li class="usa-in-page-nav__item usa-in-page-nav__item--sub-item"><a href=#constraint-messages class="site-in-page-nav__link h3">Constraint Messages</a></li><li class="usa-in-page-nav__item usa-in-page-nav__item--sub-item"><a href=#message-syntax class="site-in-page-nav__link h4">Message Syntax</a></li><li class="usa-in-page-nav__item usa-in-page-nav__item--sub-item"><a href=#message-evaluation class="site-in-page-nav__link h4">Message Evaluation</a></li><li class="usa-in-page-nav__item usa-in-page-nav__item--sub-item"><a href=#constraint-types-supporting-messages class="site-in-page-nav__link h4">Constraint Types Supporting Messages</a></li><li class="usa-in-page-nav__item usa-in-page-nav__item--sub-item"><a href=#allowed-values-constraints class="site-in-page-nav__link h3"><code>allowed-values</code> Constraints</a></li><li class="usa-in-page-nav__item usa-in-page-nav__item--sub-item"><a href=#enum class="site-in-page-nav__link h4"><code>@enum</code></a></li><li class="usa-in-page-nav__item usa-in-page-nav__item--sub-item"><a href=#allowed-values-processing class="site-in-page-nav__link h4"><code>allowed-values</code> Processing</a></li><li class="usa-in-page-nav__item usa-in-page-nav__item--sub-item"><a href=#extensible class="site-in-page-nav__link h5"><code>@extensible</code></a></li><li class="usa-in-page-nav__item usa-in-page-nav__item--sub-item"><a href=#allow-other class="site-in-page-nav__link h5"><code>@allow-other</code></a></li><li class="usa-in-page-nav__item usa-in-page-nav__item--sub-item"><a href=#expect-constraints class="site-in-page-nav__link h3"><code>expect</code> Constraints</a></li><li class="usa-in-page-nav__item usa-in-page-nav__item--sub-item"><a href=#has-cardinality-constraints class="site-in-page-nav__link h3"><code>has-cardinality</code> Constraints</a></li><li class="usa-in-page-nav__item usa-in-page-nav__item--sub-item"><a href=#index-constraints class="site-in-page-nav__link h3"><code>index</code> Constraints</a></li><li class="usa-in-page-nav__item usa-in-page-nav__item--sub-item"><a href=#index-has-key-constraints class="site-in-page-nav__link h3"><code>index-has-key</code> Constraints</a></li><li class="usa-in-page-nav__item usa-in-page-nav__item--sub-item"><a href=#is-unique-constraints class="site-in-page-nav__link h3"><code>is-unique</code> Constraints</a></li><li class="usa-in-page-nav__item usa-in-page-nav__item--sub-item"><a href=#matches-constraints class="site-in-page-nav__link h3"><code>matches</code> Constraints</a></li><li class="usa-in-page-nav__item usa-in-page-nav__item--sub-item"><a href=#report-constraints class="site-in-page-nav__link h3"><code>report</code> Constraints</a></li><li class="usa-in-page-nav__item usa-in-page-nav__item--sub-item"><a href=#expect-vs-report-comparison class="site-in-page-nav__link h4"><code>expect</code> vs <code>report</code> Comparison</a></li><li class=usa-in-page-nav__item><a href=#constraint-processing class="site-in-page-nav__link h2">Constraint Processing</a></li><li class="usa-in-page-nav__item usa-in-page-nav__item--sub-item"><a href=#processing-error-handling class="site-in-page-nav__link h3">Processing Error Handling</a></li><li class=usa-in-page-nav__item><a href=#external-constraints class="site-in-page-nav__link h2">External Constraints</a></li><li class="usa-in-page-nav__item usa-in-page-nav__item--sub-item"><a href=#metaschema-meta-constraints class="site-in-page-nav__link h3"><code>&lt;metaschema-meta-constraints></code></a></li><li class="usa-in-page-nav__item usa-in-page-nav__item--sub-item"><a href=#import-1 class="site-in-page-nav__link h3"><code>&lt;import></code></a></li><li class="usa-in-page-nav__item usa-in-page-nav__item--sub-item"><a href=#namespace-binding class="site-in-page-nav__link h3"><code>&lt;namespace-binding></code></a></li><li class="usa-in-page-nav__item usa-in-page-nav__item--sub-item"><a href=#definition-context class="site-in-page-nav__link h3"><code>&lt;definition-context></code></a></li><li class="usa-in-page-nav__item usa-in-page-nav__item--sub-item"><a href=#context class="site-in-page-nav__link h3"><code>&lt;context></code></a></li><li class="usa-in-page-nav__item usa-in-page-nav__item--sub-item"><a href=#metapath class="site-in-page-nav__link h3"><code>&lt;metapath></code></a></li><li class="usa-in-page-nav__item usa-in-page-nav__item--sub-item"><a href=#external-constraint-processing class="site-in-page-nav__link h3">External Constraint Processing</a></li></ul></nav></aside><main id=main-content class="main-content usa-prose"><header><nav class=usa-breadcrumb aria-label=Breadcrumbs><ol class=usa-breadcrumb__list><li class=usa-breadcrumb__list-item><a href=/specification/ class=usa-breadcrumb__link><span>Metaschema Specification</span></a></li><li class=usa-breadcrumb__list-item><a href=/specification/syntax/ class=usa-breadcrumb__link><span>Syntax</span></a></li><li class="usa-breadcrumb__list-item usa-current"><a href=/specification/syntax/constraints/ class=usa-breadcrumb__link aria-current=page><span>Constraints</span></a></li></ol></nav></header><h1 id=constraints><a href=#constraints>Constraints</a></h1><p>Metaschema modules can define different kinds of constraints to support data validation within and between document instances.</p><p>The types of constraints allowed for a given definition</p><h2 id=define-flag-constraints><a href=#define-flag-constraints><code>&lt;define-flag></code> constraints</a></h2><p>The following constraint types are allowed for <code>&lt;define-flag></code> definitions.</p><ul><li><a href=/specification/syntax/constraints/#let-expressions><code>&lt;let></code></a></li><li><a href=/specification/syntax/constraints/#allowed-values-constraints><code>&lt;allowed-values></code></a></li><li><a href=/specification/syntax/constraints/#expect-constraints><code>&lt;expect></code></a></li><li><a href=/specification/syntax/constraints/#index-has-key-constraints><code>&lt;index-has-key></code></a></li><li><a href=/specification/syntax/constraints/#matches-constraints><code>&lt;matches></code></a></li><li><a href=/specification/syntax/constraints/#report-constraints><code>&lt;report></code></a></li></ul><p>For each of these constraint types, use of the <code>@target</code> attribute is prohibited. This is because a flag constraint may only target the flag, since a flag has no child nodes.</p><h2 id=define-field-constraints><a href=#define-field-constraints><code>&lt;define-field></code> constraints</a></h2><p>The following constraint types are allowed for <code>&lt;define-field></code> definitions.</p><ul><li><a href=/specification/syntax/constraints/#let-expressions><code>&lt;let></code></a></li><li><a href=/specification/syntax/constraints/#allowed-values-constraints><code>&lt;allowed-values></code></a></li><li><a href=/specification/syntax/constraints/#expect-constraints><code>&lt;expect></code></a></li><li><a href=/specification/syntax/constraints/#index-has-key-constraints><code>&lt;index-has-key></code></a></li><li><a href=/specification/syntax/constraints/#matches-constraints><code>&lt;matches></code></a></li><li><a href=/specification/syntax/constraints/#report-constraints><code>&lt;report></code></a></li></ul><h2 id=define-assembly-constraints><a href=#define-assembly-constraints><code>&lt;define-assembly></code> constraints</a></h2><p>The following constraint types are allowed for <code>&lt;define-assembly></code> definitions.</p><ul><li><a href=/specification/syntax/constraints/#let-expressions><code>&lt;let></code></a></li><li><a href=/specification/syntax/constraints/#allowed-values-constraints><code>&lt;allowed-values></code></a></li><li><a href=/specification/syntax/constraints/#expect-constraints><code>&lt;expect></code></a></li><li><a href=/specification/syntax/constraints/#has-cardinality-constraints><code>&lt;has-cardinality></code></a></li><li><a href=/specification/syntax/constraints/#index-constraints><code>&lt;index></code></a></li><li><a href=/specification/syntax/constraints/#index-has-key-constraints><code>&lt;index-has-key></code></a></li><li><a href=/specification/syntax/constraints/#is-unique-constraints><code>&lt;is-unique></code></a></li><li><a href=/specification/syntax/constraints/#matches-constraints><code>&lt;matches></code></a></li><li><a href=/specification/syntax/constraints/#report-constraints><code>&lt;report></code></a></li></ul><h2 id=common-constraint-data><a href=#common-constraint-data>Common Constraint Data</a></h2><p>All <em>constraints</em> share a common syntax composed of the following:</p><table><thead><tr><th style=text-align:left>Data</th><th style=text-align:left>Data Type</th><th style=text-align:left>Use</th><th style=text-align:left>Default Value</th></tr></thead><tbody><tr><td style=text-align:left><a href=/specification/syntax/constraints/#id><code>@id</code></a></td><td style=text-align:left><a href=/specification/datatypes/#token><code>token</code></a></td><td style=text-align:left>optional</td><td style=text-align:left><em>(no default)</em></td></tr><tr><td style=text-align:left><a href=/specification/syntax/constraints/#level><code>@level</code></a></td><td style=text-align:left><code>DEBUG</code>,<code>INFORMATIONAL</code>, <code>WARNING</code>, <code>ERROR</code>, or <code>CRITICAL</code></td><td style=text-align:left>optional</td><td style=text-align:left><code>ERROR</code></td></tr><tr><td style=text-align:left><a href=/specification/syntax/constraints/#target><code>@target</code></a></td><td style=text-align:left><a href=/specification/syntax/metapath/>metapath</a></td><td style=text-align:left><em>(varies)</em></td><td style=text-align:left><code>.</code></td></tr><tr><td style=text-align:left><a href=/specification/syntax/constraints/#formal-name><code>&lt;formal-name></code></a></td><td style=text-align:left><a href=/specification/datatypes/#string><code>string</code></a></td><td style=text-align:left>0 or 1</td><td style=text-align:left><em>(no default)</em></td></tr><tr><td style=text-align:left><a href=/specification/syntax/constraints/#description><code>&lt;description></code></a></td><td style=text-align:left><a href=/specification/datatypes/#markup-line><code>markup-line</code></a></td><td style=text-align:left>0 or 1</td><td style=text-align:left><em>(no default)</em></td></tr><tr><td style=text-align:left><a href=/specification/syntax/constraints/#prop><code>&lt;prop></code></a></td><td style=text-align:left>(structured)</td><td style=text-align:left>0 to âˆž</td><td style=text-align:left><em>(no default)</em></td></tr><tr><td style=text-align:left><a href=/specification/syntax/constraints/#remarks><code>&lt;remarks></code></a></td><td style=text-align:left>(structured)</td><td style=text-align:left>0 or 1</td><td style=text-align:left><em>(no default)</em></td></tr></tbody></table><p>Each individual constraint allows the following data.</p><h3 id=id><a href=#id><code>@id</code></a></h3><p>A constraint MAY have an OPTIONAL <code>@id</code> flag, which provides an identifier for the constraint.</p><p>Metaschema processors MAY use the identifier for processing constraints and/or referencing them in output for later analysis.</p><h3 id=level><a href=#level><code>@level</code></a></h3><p>A constraint MAY have an OPTIONAL <code>@level</code> attribute, which identifies the severity level of a violation of the constraint.</p><p>If defined, a <code>@level</code> MUST have a value of either: <code>CRITICAL</code>, <code>ERROR</code>, <code>WARNING</code>, <code>INFORMATIONAL</code>, or <code>DEBUG</code>.</p><p>These values have the following definitions:</p><ul><li><strong>CRITICAL</strong>: A violation of the constraint represents a serious fault in the content that will prevent typical use of the content.</li><li><strong>ERROR</strong>: A violation of the constraint represents a fault in the content. This may include issues around compatibility, integrity, consistency, etc.</li><li><strong>WARNING</strong>: A violation of the constraint represents a potential issue with the content.</li><li><strong>INFORMATIONAL</strong>: A violation of the constraint represents a point of interest.</li><li><strong>DEBUG</strong>: A violation of the constraint represents a fault in the content that may warrant review by a developer when performing model or tool development.</li></ul><p>Metaschema processors MAY perform conditional processing and/or presentation of constraint violations based on the level value.</p><h3 id=target><a href=#target><code>@target</code></a></h3><p>The <em>target</em> of a constraint identifies the content nodes that a constraint applies to.</p><p>Not all constraint types require a <code>@target</code>. Each constraint type defines if the <code>@target</code> is required, optional, or implicit.</p><p>When provided, the value of a <code>@target</code> MUST be a valid Metapath expression.</p><p>If a <code>@target</code> value is not defined, a Metaschema processor MUST process the value as <code>target="."</code>, the current context of that constraint definition in a module, for a <a href=/specification/syntax/constraints/#define-field-constraints>field</a> or <a href=/specification/syntax/constraints/#define-flag-constraints>flag</a>.</p><p>A <em>target</em> can apply to any node(s) in the document instance(s). There is no guarantee the constraint <em>target</em> is a child of its respective assembly, field, or flag. Thus, a Metaschema processor MUST resolve the Metapath expression to identify the actual target nodes that the constraint applies to. If no resulting target nodes are identified, then the constraint MUST be ignored.</p><h3 id=deprecated-version><a href=#deprecated-version><code>@deprecated</code> Version</a></h3><p>The optional <code>@deprecated</code> attribute communicates that use of the given <em>information element</em> implemented by the <em>definition</em> is intended to be discontinued, starting with the <em>information model</em> revision indicated by the attribute&rsquo;s value.</p><p>This attribute&rsquo;s value MUST be a version <a href=/specification/datatypes/#string>string</a> that is equal to or comes before the <a href=/specification/syntax/module/#schema-version><code>&lt;schema-version></code></a> declared in the <em>Metaschema module</em> <em>header</em>.</p><div class=callout>Declaring the <code>@deprecated</code> attribute communicates to content creators that all use of the annotated <em>information element</em> is to be avoided. This annotation can be used in documentation generation and in Metaschema-aware tools that provide context around use of the definition.</div><p>The following example illustrates deprecating the flag named <code>flag-name</code> starting with the <em>information model</em> semantic version <code>1.1.0</code>.</p><div id=tabs-1 class="codetabs usa-accordion"><ul><li class=codetab><button class=usa-accordion__button aria-expanded=true aria-controls=tabs-1-json-tab><span>JSON</span></button></li><li class=codetab><button class=usa-accordion__button aria-expanded=true aria-controls=tabs-1-yaml-tab><span>YAML</span></button></li><li class=codetab><button class=usa-accordion__button aria-expanded=true aria-controls=tabs-1-xml-tab><span>XML</span></button></li></ul><div id=tabs-1-content class=codetab-content><div id=tabs-1-json-tab class=codetab-content-item><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;object-type&#34;</span><span class=p>:</span> <span class=s2>&#34;flag&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;flag-name&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;deprecated&#34;</span><span class=p>:</span> <span class=s2>&#34;1.1.0&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div></div><div id=tabs-1-yaml-tab class=codetab-content-item><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>object-type</span><span class=p>:</span><span class=w> </span><span class=l>flag</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>flag-name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>deprecated</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;1.1.0&#34;</span><span class=w>
</span></span></span></code></pre></div></div><div id=tabs-1-xml-tab class=codetab-content-item><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;define-flag</span>
</span></span><span class=line><span class=cl>  <span class=na>name=</span><span class=s>&#34;flag-name&#34;</span>
</span></span><span class=line><span class=cl>  <span class=na>deprecated=</span><span class=s>&#34;1.1.0&#34;</span><span class=nt>/&gt;</span>
</span></span></code></pre></div></div></div></div><h3 id=name><a href=#name><code>@name</code></a></h3><p>The <code>@name</code> attribute provides the definition&rsquo;s identifier, which can be used in other parts of a module, or in an importing <em>Metaschema module</em>, to reference the definition.</p><p>In top-level definitions, this attribute&rsquo;s value MUST be a <a href=/specification/datatypes/#token>token</a> that is unique among sibling definitions of the same type.</p><p><strong>Note:</strong> The names of flags, fields, and assemblies are expected to be maintained as separate identifier sets. This allows a <em>flag definition</em>, a <em>field definition</em>, and an <em>assembly definition</em> to each have the same name in a given <em>Metaschema module</em>.</p><h3 id=scope><a href=#scope><code>@scope</code></a></h3><p>The optional <code>@scope</code> attribute is used to communicate the intended visibility of the definition when accessed by another module through an <a href=/specification/syntax/module/#import><code>&lt;import></code></a> element.</p><ul><li><code>global</code> - Indicates that the definition MUST be made available for reference within importing modules. Definitions in the same and importing modules can reference it. This is the default behavior when <code>@scope</code> is not declared.</li><li><code>local</code> - Indicates that the definition MUST NOT be made available for reference within importing modules. Only definitions in the same module can reference it.</li></ul><p>Note: References to definitions in the same module are always possible regardless of scope.</p><p>The scope of a definition affects how the <a href=/specification/syntax/module/#definition-name-resolution>definition&rsquo;s name is resolved</a>.</p><h3 id=formal-name><a href=#formal-name><code>&lt;formal-name></code></a></h3><p>The optional <code>&lt;formal-name></code> field provides a human-readable, short string label for the constraint for use in documentation.</p><div class=callout><p>The <code>&lt;formal-name></code> label is intended to provide an easy to recognize, meaningful name for the constraint.</p><p>While not required, it is best practice to include a <code>&lt;formal-name></code>.</p></div><h3 id=description><a href=#description><code>&lt;description></code></a></h3><p>The optional <code>&lt;description></code> field is a <a href=/specification/datatypes/#markup-line>single line of markup</a> that describes the semantic meaning and use of the constraint.</p><div class=callout><p>The description ties the constraint to the related information element concept in the information domain that the constraint is representing. This information is ideal for use in documentation.</p><p>While not required, it is best practice to include a <code>&lt;description></code>.</p></div><h3 id=prop><a href=#prop><code>&lt;prop></code></a></h3><p>The optional <code>&lt;prop></code> assembly provides a structure for declaring arbitrary properties, which consist of a <code>@namespace</code>, <code>@name</code>, and <code>@value</code>.</p><table><thead><tr><th style=text-align:left>Data</th><th style=text-align:left>Data Type</th><th style=text-align:left>Use</th><th style=text-align:left>Default Value</th></tr></thead><tbody><tr><td style=text-align:left><code>@namespace</code></td><td style=text-align:left><a href=/specification/datatypes/#uri><code>uri</code></a></td><td style=text-align:left>optional</td><td style=text-align:left><code>http://csrc.nist.gov/ns/oscal/metaschema/1.0</code></td></tr><tr><td style=text-align:left><code>@name</code></td><td style=text-align:left><a href=/specification/datatypes/#token><code>token</code></a></td><td style=text-align:left>required</td><td style=text-align:left><em>(no default)</em></td></tr><tr><td style=text-align:left><code>@value</code></td><td style=text-align:left><a href=/specification/datatypes/#token><code>token</code></a></td><td style=text-align:left>required</td><td style=text-align:left><em>(no default)</em></td></tr></tbody></table><p>The <code>@name</code> and <code>@namespace</code> is used in combination to define a semantically unique name, represented by the <code>@name</code> attribute, within the managed namespace defined by the <code>@namespace</code> attribute. If the <code>@namespace</code> attribute is omitted, the <code>@name</code> MUST be considered in the <code>http://csrc.nist.gov/ns/oscal/metaschema/1.0</code> namespace.</p><p>The <code>@value</code> flag represents the lexical value assignment for the semantically unique name represented by the combination of the <code>@name</code> and <code>@namespace</code>. The lexical values of the <code>@value</code> attribute may be restricted for the specific semantically unique name, but such restrictions are not enforced directly in this model.</p><div class=callout>A property is useful for annotating a constraint with additional information that might describe, in a structured way, the semantics, use, nature, or other significant information related to the constraint. In many cases, a property might be used to tailor generated documentation or to support an experimental, non-standardized feature in Metaschema.</div><h3 id=remarks><a href=#remarks><code>&lt;remarks></code></a></h3><p>The optional <code>&lt;remarks></code> field provides a place to add notes related to the use of the constraint. Remarks can be used to clarify the semantics of the constraint in specific conditions, or to better describe how the constraint is utilized within a model.</p><p>The <code>&lt;remarks></code> field is optional and may occur multiple times.</p><p>It supports an optional <code>@class</code> flag that can be used to identify format specific remarks, to be handled appropriately (or ignored when not useful) in a downstream application. Valid values for <code>@class</code> are:</p><ul><li><code>XML</code>: The remark applies to the XML format binding.</li><li><code>JSON</code>: The remark applies to the JSON or YAML format bindings.</li></ul><h2 id=metapath-expressions-in-constraints><a href=#metapath-expressions-in-constraints>Metapath Expressions in Constraints</a></h2><p>Several constraint attributes accept <a href=/specification/syntax/metapath/>Metapath expressions</a> as their values. Understanding how these expressions are evaluated is essential for writing effective constraints.</p><h3 id=metapath-accepting-attributes><a href=#metapath-accepting-attributes>Metapath-Accepting Attributes</a></h3><p>The following attributes accept Metapath expressions:</p><table><thead><tr><th>Attribute</th><th>Constraint Types</th><th>Purpose</th></tr></thead><tbody><tr><td><code>@target</code></td><td>All constraint types</td><td>Specifies the node(s) the constraint applies to</td></tr><tr><td><code>@test</code></td><td><code>expect</code>, <code>report</code></td><td>Boolean condition to evaluate</td></tr><tr><td><code>@expression</code></td><td><code>let</code></td><td>Expression whose result binds to a variable</td></tr></tbody></table><p>Additionally, the <code>&lt;message></code> element in all constraint types supports <a href=/specification/syntax/constraints/#constraint-messages>Metapath expression templates</a> using <code>{expression}</code> syntax.</p><h3 id=evaluation-focus><a href=#evaluation-focus>Evaluation Focus</a></h3><p>When a Metapath expression is evaluated, it operates relative to a <em>focus node</em> (also called the <em>evaluation focus</em>). The focus node varies depending on the context:</p><table><thead><tr><th>Context</th><th>Focus Node</th></tr></thead><tbody><tr><td><code>@target</code> expressions</td><td>The content node associated with the definition where the constraint is declared</td></tr><tr><td><code>@test</code> expressions</td><td>Each node selected by the <code>@target</code> expression, evaluated in sequence</td></tr><tr><td><code>@expression</code> in <code>&lt;let></code></td><td>The current node in the constraint evaluation context</td></tr><tr><td><code>&lt;message></code> templates</td><td>The failing target node</td></tr></tbody></table><p>For detailed evaluation semantics, see <a href=/specification/syntax/constraints/#constraint-processing>Constraint Processing</a>.</p><h2 id=constraint-types><a href=#constraint-types>Constraint Types</a></h2><p>The following describes the supported constraint constructs.</p><h3 id=let-expressions><a href=#let-expressions><code>let</code> Expressions</a></h3><p>The optional <code>&lt;let></code> assembly provides a structure for variable/expression bindings, which consist of a <code>@var</code> and <code>@expression</code>.</p><table><thead><tr><th style=text-align:left>Data</th><th style=text-align:left>Data Type</th><th style=text-align:left>Use</th><th style=text-align:left>Default Value</th></tr></thead><tbody><tr><td style=text-align:left><code>@var</code></td><td style=text-align:left><a href=/specification/datatypes/#token><code>token</code></a></td><td style=text-align:left>required</td><td style=text-align:left><em>(no default)</em></td></tr><tr><td style=text-align:left><code>@expression</code></td><td style=text-align:left><a href=/specification/syntax/metapath/>metapath</a></td><td style=text-align:left>required</td><td style=text-align:left><em>(no default)</em></td></tr></tbody></table><p>Using the <code>let</code> assembly, a variable can be defined, which can be used by reference in a Metapath expression in subsequent constraints.</p><p>A <code>let</code> statement has a REQUIRED <code>@var</code> flag, which defines the variable name.</p><p>A <code>let</code> statement has a REQUIRED <code>@expression</code> flag, which defines an <a href=/specification/syntax/metapath/>Metapath expression</a>, whose result is used to define the variable&rsquo;s value in the evaluation context.</p><p>During constraint evaluation, each <code>let</code> statement MUST be evaluated in encounter order. If a previous variable is bound with the same name in the evaluation context, the new value MUST bound in a sub-context to avoid side effects. This sub-context MUST be made available to any constraints following the <code>let</code> statement declaration, and to any constraints defined on child nodes of the current context.</p><p>During evaluation, when a variable is bound for a <code>let</code> statement, the variables value MUST be set to the result of evaluating the <code>@expression</code> using the current node as the Metapath evaluation focus.</p><p>For example:</p><p>Given the following fragment of a Metaschema module.</p><div id=tabs-5 class="codetabs usa-accordion"><ul><li class=codetab><button class=usa-accordion__button aria-expanded=true aria-controls=tabs-5-json-tab><span>JSON</span></button></li><li class=codetab><button class=usa-accordion__button aria-expanded=true aria-controls=tabs-5-yaml-tab><span>YAML</span></button></li><li class=codetab><button class=usa-accordion__button aria-expanded=true aria-controls=tabs-5-xml-tab><span>XML</span></button></li></ul><div id=tabs-5-content class=codetab-content><div id=tabs-5-json-tab class=codetab-content-item><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;object-type&#34;</span><span class=p>:</span> <span class=s2>&#34;assembly&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;sibling&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;flags&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;object-type&#34;</span><span class=p>:</span> <span class=s2>&#34;flag&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;name&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;required&#34;</span><span class=p>:</span> <span class=s2>&#34;yes&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;constraints&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;lets&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span> <span class=nt>&#34;var&#34;</span><span class=p>:</span> <span class=s2>&#34;parent&#34;</span><span class=p>,</span> <span class=nt>&#34;expression&#34;</span><span class=p>:</span> <span class=s2>&#34;..&#34;</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span> <span class=nt>&#34;var&#34;</span><span class=p>:</span> <span class=s2>&#34;sibling-count&#34;</span><span class=p>,</span> <span class=nt>&#34;expression&#34;</span><span class=p>:</span> <span class=s2>&#34;count($parent/sibling)&#34;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;rules&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;object-type&#34;</span><span class=p>:</span> <span class=s2>&#34;expect&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;target&#34;</span><span class=p>:</span> <span class=s2>&#34;.&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;test&#34;</span><span class=p>:</span> <span class=s2>&#34;$sibling-count = 3&#34;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div></div><div id=tabs-5-yaml-tab class=codetab-content-item><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>object-type</span><span class=p>:</span><span class=w> </span><span class=l>assembly</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>sibling</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>flags</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>object-type</span><span class=p>:</span><span class=w> </span><span class=l>flag</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>required</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;yes&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>constraints</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>lets</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>var</span><span class=p>:</span><span class=w> </span><span class=l>parent</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>expression</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;..&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>var</span><span class=p>:</span><span class=w> </span><span class=l>sibling-count</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>expression</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;count($parent/sibling)&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>object-type</span><span class=p>:</span><span class=w> </span><span class=l>expect</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>target</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;.&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>test</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;$sibling-count = 3&#34;</span><span class=w>
</span></span></span></code></pre></div></div><div id=tabs-5-xml-tab class=codetab-content-item><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;define-assembly</span> <span class=na>name=</span><span class=s>&#34;sibling&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;define-flag</span> <span class=na>name=</span><span class=s>&#34;name&#34;</span> <span class=na>required=</span><span class=s>&#34;yes&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;constraint&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- stores the parent of the current node --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;let</span> <span class=na>var=</span><span class=s>&#34;parent&#34;</span> <span class=na>expression=</span><span class=s>&#34;..&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;let</span> <span class=na>var=</span><span class=s>&#34;sibling-count&#34;</span> <span class=na>expression=</span><span class=s>&#34;count($parent/sibling)&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;expect</span> <span class=na>target=</span><span class=s>&#34;.&#34;</span> <span class=na>test=</span><span class=s>&#34;$sibling-count = 3&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/constraint&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/define-assembly&gt;</span>
</span></span></code></pre></div></div></div></div><p>And the following document instance.</p><div id=tabs-6 class="codetabs usa-accordion"><ul><li class=codetab><button class=usa-accordion__button aria-expanded=true aria-controls=tabs-6-json-tab><span>JSON</span></button></li><li class=codetab><button class=usa-accordion__button aria-expanded=true aria-controls=tabs-6-yaml-tab><span>YAML</span></button></li><li class=codetab><button class=usa-accordion__button aria-expanded=true aria-controls=tabs-6-xml-tab><span>XML</span></button></li></ul><div id=tabs-6-content class=codetab-content><div id=tabs-6-json-tab class=codetab-content-item><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;parent&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;p1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;sibling&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span> <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;a&#34;</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span> <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;b&#34;</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span> <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;c&#34;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;p2&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;sibling&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span> <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;x&#34;</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span> <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;y&#34;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div></div><div id=tabs-6-yaml-tab class=codetab-content-item><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>parent</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>p1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>sibling</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>a</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>b</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>c</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>p2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>sibling</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>x</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=kc>y</span><span class=w>
</span></span></span></code></pre></div></div><div id=tabs-6-xml-tab class=codetab-content-item><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;parent</span> <span class=na>name=</span><span class=s>&#34;p1&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;sibling</span> <span class=na>name=</span><span class=s>&#34;a&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;sibling</span> <span class=na>name=</span><span class=s>&#34;b&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;sibling</span> <span class=na>name=</span><span class=s>&#34;c&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/parent&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;parent</span> <span class=na>name=</span><span class=s>&#34;p2&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;sibling</span> <span class=na>name=</span><span class=s>&#34;x&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;sibling</span> <span class=na>name=</span><span class=s>&#34;y&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/parent&gt;</span>
</span></span></code></pre></div></div></div></div><p>The expect constraint would pass for each <code>sibling</code> in the <code>parent</code> named &ldquo;p1&rdquo;, and would fail for each <code>sibling</code> in the <code>parent</code> named &ldquo;p2&rdquo;.</p><h3 id=constraint-messages><a href=#constraint-messages>Constraint Messages</a></h3><p>All constraint types support an optional <code>&lt;message></code> child element that provides a custom message to be displayed when the constraint fails validation.</p><h4 id=message-syntax><a href=#message-syntax>Message Syntax</a></h4><p>The <code>&lt;message></code> element value MUST be a <a href=/specification/datatypes/#string>Metaschema string value</a>. The message MAY contain <a href=/specification/syntax/metapath/>Metapath</a> expression templates using the following syntax:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>{metapath-expression}
</span></span></code></pre></div><p>A template starts with <code>{</code>, contains a Metapath expression, and ends with <code>}</code>. Multiple templates MAY appear within a single message. Any text outside of template delimiters is treated as literal text.</p><p><strong>Example:</strong></p><div id=tabs-7 class="codetabs usa-accordion"><ul><li class=codetab><button class=usa-accordion__button aria-expanded=true aria-controls=tabs-7-json-tab><span>JSON</span></button></li><li class=codetab><button class=usa-accordion__button aria-expanded=true aria-controls=tabs-7-yaml-tab><span>YAML</span></button></li><li class=codetab><button class=usa-accordion__button aria-expanded=true aria-controls=tabs-7-xml-tab><span>XML</span></button></li></ul><div id=tabs-7-content class=codetab-content><div id=tabs-7-json-tab class=codetab-content-item><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;object-type&#34;</span><span class=p>:</span> <span class=s2>&#34;expect&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;target&#34;</span><span class=p>:</span> <span class=s2>&#34;.&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;test&#34;</span><span class=p>:</span> <span class=s2>&#34;@min le @max&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;message&#34;</span><span class=p>:</span> <span class=s2>&#34;The minimum value {@min} must be less than or equal to the maximum value {@max}.&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div></div><div id=tabs-7-yaml-tab class=codetab-content-item><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>object-type</span><span class=p>:</span><span class=w> </span><span class=l>expect</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>target</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;.&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>test</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;@min le @max&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>message</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;The minimum value {@min} must be less than or equal to the maximum value {@max}.&#34;</span><span class=w>
</span></span></span></code></pre></div></div><div id=tabs-7-xml-tab class=codetab-content-item><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;expect</span> <span class=na>target=</span><span class=s>&#34;.&#34;</span> <span class=na>test=</span><span class=s>&#34;@min le @max&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;message&gt;</span>The minimum value {@min} must be less than or equal to the maximum value {@max}.<span class=nt>&lt;/message&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/expect&gt;</span>
</span></span></code></pre></div></div></div></div><h4 id=message-evaluation><a href=#message-evaluation>Message Evaluation</a></h4><p>When a constraint fails, the <code>&lt;message></code> is evaluated to produce the final message text:</p><ol><li>Each Metapath template expression <code>{...}</code> is evaluated</li><li>The <a href=/specification/syntax/constraints/#evaluation-focus>evaluation focus</a> for template expressions is the failing target node</li><li>The result of each expression replaces its template in the message</li><li>Literal text outside templates is preserved as-is</li></ol><p>If no <code>&lt;message></code> is provided, Metaschema processors SHOULD generate a default message describing the constraint failure.</p><h4 id=constraint-types-supporting-messages><a href=#constraint-types-supporting-messages>Constraint Types Supporting Messages</a></h4><table><thead><tr><th>Constraint Type</th><th><code>&lt;message></code> Support</th></tr></thead><tbody><tr><td><a href=/specification/syntax/constraints/#allowed-values-constraints><code>allowed-values</code></a></td><td>Yes</td></tr><tr><td><a href=/specification/syntax/constraints/#expect-constraints><code>expect</code></a></td><td>Yes</td></tr><tr><td><a href=/specification/syntax/constraints/#has-cardinality-constraints><code>has-cardinality</code></a></td><td>Yes</td></tr><tr><td><a href=/specification/syntax/constraints/#index-constraints><code>index</code></a></td><td>Yes</td></tr><tr><td><a href=/specification/syntax/constraints/#index-has-key-constraints><code>index-has-key</code></a></td><td>Yes</td></tr><tr><td><a href=/specification/syntax/constraints/#is-unique-constraints><code>is-unique</code></a></td><td>Yes</td></tr><tr><td><a href=/specification/syntax/constraints/#matches-constraints><code>matches</code></a></td><td>Yes</td></tr></tbody></table><h3 id=allowed-values-constraints><a href=#allowed-values-constraints><code>allowed-values</code> Constraints</a></h3><p>The <code>allowed-values</code> constraint is a type of Metaschema constraint that restricts field or flag value(s) based on an enumerated set of permitted values.</p><p>The syntax of <code>&lt;allowed-values></code> consists of the following:</p><table><thead><tr><th style=text-align:left>Data</th><th style=text-align:left>Data Type</th><th style=text-align:left>Use</th><th style=text-align:left>Default Value</th></tr></thead><tbody><tr><td style=text-align:left><a href=/specification/syntax/constraints/#allow-other><code>@allow-other</code>></a></td><td style=text-align:left><code>yes</code> or <code>no</code></td><td style=text-align:left>optional</td><td style=text-align:left><code>no</code></td></tr><tr><td style=text-align:left><a href=/specification/syntax/constraints/#extensible><code>@extensible</code>></a></td><td style=text-align:left><code>model</code>, <code>external</code>, or <code>none</code></td><td style=text-align:left>optional</td><td style=text-align:left><code>no</code></td></tr><tr><td style=text-align:left><a href=/specification/syntax/constraints/#id><code>@id</code></a></td><td style=text-align:left><a href=/specification/datatypes/#token><code>token</code></a></td><td style=text-align:left>optional</td><td style=text-align:left><em>(no default)</em></td></tr><tr><td style=text-align:left><a href=/specification/syntax/constraints/#level><code>@level</code></a></td><td style=text-align:left><code>DEBUG</code>,<code>INFORMATIONAL</code>, <code>WARNING</code>, <code>ERROR</code>, or <code>CRITICAL</code></td><td style=text-align:left>optional</td><td style=text-align:left><code>ERROR</code></td></tr><tr><td style=text-align:left><a href=/specification/syntax/constraints/#target><code>@target</code></a></td><td style=text-align:left><a href=/specification/syntax/metapath/>metapath</a></td><td style=text-align:left><em>(varies)</em></td><td style=text-align:left><em>(no default)</em></td></tr><tr><td style=text-align:left><a href=/specification/syntax/constraints/#formal-name><code>&lt;formal-name></code></a></td><td style=text-align:left><a href=/specification/datatypes/#string><code>string</code></a></td><td style=text-align:left>0 or 1</td><td style=text-align:left><em>(no default)</em></td></tr><tr><td style=text-align:left><a href=/specification/syntax/constraints/#description><code>&lt;description></code></a></td><td style=text-align:left><a href=/specification/datatypes/#markup-line><code>markup-line</code></a></td><td style=text-align:left>0 or 1</td><td style=text-align:left><em>(no default)</em></td></tr><tr><td style=text-align:left><a href=/specification/syntax/constraints/#prop><code>&lt;prop></code></a></td><td style=text-align:left>(structured)</td><td style=text-align:left>0 to âˆž</td><td style=text-align:left><em>(no default)</em></td></tr><tr><td style=text-align:left><a href=/specification/syntax/constraints/#enum><code>&lt;enum></code></a></td><td style=text-align:left>(structured)</td><td style=text-align:left>1 to âˆž</td><td style=text-align:left><em>(no default)</em></td></tr><tr><td style=text-align:left><a href=/specification/syntax/constraints/#constraint-messages><code>&lt;message></code></a></td><td style=text-align:left><a href=/specification/syntax/constraints/#constraint-messages>template</a></td><td style=text-align:left>0 or 1</td><td style=text-align:left><em>(no default)</em></td></tr><tr><td style=text-align:left><a href=/specification/syntax/constraints/#remarks><code>&lt;remarks></code></a></td><td style=text-align:left>(structured)</td><td style=text-align:left>0 or 1</td><td style=text-align:left><em>(no default)</em></td></tr></tbody></table><p>Each <code>allowed-values</code> constraint has a <em>source</em> that will be either:</p><ul><li><strong>model:</strong> The constraint is defined <em>in</em> a Metaschema module, i.e. an internal constraint.</li><li><strong>external:</strong> The constraint is defined <em>outside</em> a Metaschema module, i.e. an external constraint.</li></ul><p>The <code>@target</code> of an <code>&lt;allowed-values></code> constraint is a <a href=/specification/syntax/metapath/>Metapath expression</a> that specifies the node(s) in a document instance whose value is restricted by the constraint.</p><h4 id=enum><a href=#enum><code>@enum</code></a></h4><p>Within a given <code>&lt;allowed-values></code> constraint, an <code>&lt;enum></code> expresses an individual allowed value, expressed using that field&rsquo;s <code>@value</code> flag.</p><p>A Metaschema processor MAY use the text value of the <code>enum</code>&rsquo;s XML element as documentation for a given allowed value enumeration. Below is an example.</p><div id=tabs-8 class="codetabs usa-accordion"><ul><li class=codetab><button class=usa-accordion__button aria-expanded=true aria-controls=tabs-8-json-tab><span>JSON</span></button></li><li class=codetab><button class=usa-accordion__button aria-expanded=true aria-controls=tabs-8-yaml-tab><span>YAML</span></button></li><li class=codetab><button class=usa-accordion__button aria-expanded=true aria-controls=tabs-8-xml-tab><span>XML</span></button></li></ul><div id=tabs-8-content class=codetab-content><div id=tabs-8-json-tab class=codetab-content-item><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;object-type&#34;</span><span class=p>:</span> <span class=s2>&#34;flag&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;form-factor&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;formal-name&#34;</span><span class=p>:</span> <span class=s2>&#34;Computer Form Factor&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;description&#34;</span><span class=p>:</span> <span class=s2>&#34;The type of computer in the example application&#39;s data model.&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;constraints&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;rules&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;object-type&#34;</span><span class=p>:</span> <span class=s2>&#34;allowed-values&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;allow-other&#34;</span><span class=p>:</span> <span class=s2>&#34;yes&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;enums&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=s2>&#34;laptop&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;remark&#34;</span><span class=p>:</span> <span class=s2>&#34;this text value documents the domain and information model&#39;s meaning of a laptop&#34;</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=s2>&#34;desktop&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;remark&#34;</span><span class=p>:</span> <span class=s2>&#34;this text value documents the domain and information model&#39;s meaning of a desktop&#34;</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div></div><div id=tabs-8-yaml-tab class=codetab-content-item><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>object-type</span><span class=p>:</span><span class=w> </span><span class=l>flag</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>form-factor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>formal-name</span><span class=p>:</span><span class=w> </span><span class=l>Computer Form Factor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=l>The type of computer in the example application&#39;s data model.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>constraints</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>object-type</span><span class=p>:</span><span class=w> </span><span class=l>allowed-values</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>allow-other</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;yes&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>enums</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=l>laptop</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>remark</span><span class=p>:</span><span class=w> </span><span class=p>&gt;-</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>            this text value documents the domain and
</span></span></span><span class=line><span class=cl><span class=sd>            information model&#39;s meaning of a laptop</span><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=l>desktop</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>remark</span><span class=p>:</span><span class=w> </span><span class=p>&gt;-</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>            this text value documents the domain and
</span></span></span><span class=line><span class=cl><span class=sd>            information model&#39;s meaning of a desktop</span><span class=w>            
</span></span></span></code></pre></div></div><div id=tabs-8-xml-tab class=codetab-content-item><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;define-flag</span> <span class=na>name=</span><span class=s>&#34;form-factor&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;formal-name&gt;</span>Computer Form Factor<span class=nt>&lt;/formal-name&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;description&gt;</span>The type of computer in the example application&#39;s data
</span></span><span class=line><span class=cl>    model.<span class=nt>&lt;/description&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;constraint&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;allowed-values</span> <span class=na>allow-other=</span><span class=s>&#34;yes&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;enum</span> <span class=na>value=</span><span class=s>&#34;laptop&#34;</span><span class=nt>&gt;</span>this text value documents the domain and
</span></span><span class=line><span class=cl>        information model&#39;s meaning of a laptop<span class=nt>&lt;/enum&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;enum</span> <span class=na>value=</span><span class=s>&#34;desktop&#34;</span><span class=nt>&gt;</span>this text value documents the domain and
</span></span><span class=line><span class=cl>        information model&#39;s meaning of a desktop<span class=nt>&lt;/enum&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/allowed-values&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/constraint&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/define-flag&gt;</span>
</span></span></code></pre></div></div></div></div><h4 id=allowed-values-processing><a href=#allowed-values-processing><code>allowed-values</code> Processing</a></h4><p>Metaschema processors MUST process <code>&lt;allowed-values></code> constraints.</p><p>The constraint&rsquo;s <code>@target</code> is a <a href=/specification/syntax/metapath/>Metapath expression</a> that identifies the node values the constraint applies to.</p><p>A <code>@target</code> is REQUIRED for allowed value constraints associated with a field and assembly. A <code>@target</code> MUST NOT be provided for an allowed value constraint associated with a flag, since such a constraint can only target the flag&rsquo;s value. In flag use cases the <code>@target</code> MUST be considered <code>.</code>, referring to the flag node.</p><p>When evaluating the <code>@target</code> Metapath expression, the Metapath focus MUST be the constraint&rsquo;s <em>evaluation focus</em>. Thus, the targets are determined in the context in where the constraint is declared.</p><p>The sequence of nodes that result from Metapath evaluation are the constraints <em>target node(s)</em>.</p><p>The nodes resulting from evaluating an <code>&lt;allowed-values></code> <code>@target</code> are intended to be <em>field</em> or <em>flag</em> nodes, which have a value. If these nodes are an instance of an <em>assembly</em>, a Metaschema processor error SHOULD be raised.</p><p>Multiple <code>&lt;allowed-values></code> constraints can apply to a given <em>target node</em>, which may be declared by constraints defined on different content nodes. Implementations will need a means to determine the complete set of <code>&lt;allowed-values></code> constraints that apply to a given <em>target node</em>, which is referred to as the <em>target node&rsquo;s</em> &ldquo;<em>applicable set</em>&rdquo;.</p><p>This may be handled using a two phased evaluation that first resolves the <code>&lt;allowed-values></code> constraints associated with each <em>target node</em> determining the <em>applicable set</em>, then, second, evaluates the <em>applicable set</em> for each <em>target node</em>. Other implementations may be possible and are allowed if they result in the same effective behavior.</p><p>The <em>applicable set</em> of <code>&lt;allowed-values></code> constraints is verified for correctness using the <code>@extension</code> attribute on each set member.</p><p>For each <code>&lt;allowed-values></code> in the <em>applicable set</em>, the <code>@allow-other</code> attribute is used to determine the <em>expected value set</em> for a given content value.</p><p>The following subsections detail the processing requirements for the <code>@extension</code> and <code>@allow-other</code> attributes.</p><h5 id=extensible><a href=#extensible><code>@extensible</code></a></h5><p>For each <code>&lt;allowed-values></code> constraints the <em>applicable set</em>, the <code>@extension</code> attribute MUST be one of the following values.</p><ul><li><p><strong><code>none</code>:</strong> There can be no other matching <code>&lt;allowed-values></code> constraint for the same target value. This is the least permissive option.</p></li><li><p><strong><code>model</code>:</strong> (default) Multiple matching <code>&lt;allowed-values></code> constraints are allowed for the same target value as long as the constraints are defined in the same model. Constraints sourced from outside the model are not allowed.</p><p>All allowed-values constraints declared within a Metaschema model matching the same @target can be combined. If a matching constraint within the model has allow-other=&ldquo;no&rdquo;, then constraints declared externally from the model are not allowed. <strong>This is the implicit default value if no <code>@extension</code> is provided.</strong></p></li><li><p><strong><code>external</code>:</strong> Multiple matching <code>&lt;allowed-values></code> constraints are allowed for the same target value, which can be sourced from within the model or externally through a set of external constraints.</p><p>All allowed-values constraints, declared within the model and externally through an extension, that match the same @target can be combined. This is the most permissive option.</p></li></ul><p>One of the following requirements MUST apply when processing a value&rsquo;s <em>applicable set</em> to validate it.</p><ol><li>The <em>applicable set</em> MUST contain a single <code>&lt;allowed-values></code> constraint with the <code>@extension</code> attribute value <code>none</code>.</li><li>All <code>&lt;allowed-values></code> constraints in the <em>applicable set</em> MUST have the <code>@extension</code> attribute value <code>model</code> and originate from a <em>model</em> source.</li><li>All <code>&lt;allowed-values></code> constraints in the <em>applicable set</em> MUST have the <code>@extension</code> attribute value <code>external</code> and originate from either a <em>model</em> or <em>extension</em> source.</li><li>An error MUST be raised indicating the <em>applicable set</em> is invalid.</li></ol><h5 id=allow-other><a href=#allow-other><code>@allow-other</code></a></h5><p>The <em>expected value set</em> can be considered <em>open</em> or <em>closed</em>.</p><ul><li><strong>open:</strong> In an open set, the actual value can be any value. The <em>expected value set</em> provides suggested values.</li><li><strong>closed:</strong> In a closed set, the actual value is expected to match a value in the <em>expected value set</em>.</li></ul><p>For each <code>&lt;allowed-values></code> constraint, the <code>@allow-other</code> attribute MUST be one of the following values.</p><ul><li><strong><code>yes</code>:</strong> Identifies the <em>expected value set</em> as <em>open</em>, as long as no other <code>&lt;allowed-values></code> constraint in the <em>applicable set</em> has <code>@allow-other="no"</code> declared explicitly or implicitly.</li><li><strong><code>no</code>:</strong> (default) Identifies the <em>expected value set</em> as <em>closed</em>. <strong>This is the implicit default value if no <code>@allow-other</code> is provided.</strong></li></ul><p>One of the following requirements MUST apply when processing a value&rsquo;s <em>targeting set</em> of <code>&lt;allowed-values></code> constraints to determine the <em>expected value set</em>.</p><ol><li><p>One <code>&lt;allowed-values></code> constraint in the <em>applicable set</em> MUST have the <code>@allow-other</code> attribute value <code>no</code>. The <em>expected value set</em> is <em>closed</em>.</p><p>The actual value MUST match one of the enumerated values declared on any of the <code>&lt;allowed-values></code> constraints in the <em>targeting set</em>. An error MUST be produced to indicate that the value doesn&rsquo;t match one of the enumerated values.</p><p>It is possible to require a value that does not align with the value node&rsquo;s Metaschema data type. In such cases, this creates a situation where both the data type and a closed value requirement cannot be met. In such cases, the constraint processor MUST report this as an error.</p></li><li><p>All <code>&lt;allowed-values></code> constraints in the <em>applicable set</em> MUST have the <code>@allow-other</code> attribute value <code>yes</code>. The <em>expected value set</em> is <em>open</em>.</p><p>Any type-appropriate actual value MUST be allowed. A warning MAY be produced to indicate that the value doesn&rsquo;t match one of the enumerated values.</p></li></ol><h3 id=expect-constraints><a href=#expect-constraints><code>expect</code> Constraints</a></h3><p>The <code>&lt;expect></code> constraint is a type of Metaschema constraint that restricts field or flag value(s) based on the evaluation of a <code>@test</code> Metapath expression. See also the <a href=/specification/syntax/constraints/#report-constraints><code>&lt;report></code></a> constraint, which is the semantic inverse of <code>&lt;expect></code>. For a comparison of these two constraint types, see <a href=/specification/syntax/constraints/#expect-vs-report-comparison><code>expect</code> vs <code>report</code> Comparison</a>.</p><p>The syntax of <code>&lt;expect></code> consists of the following:</p><table><thead><tr><th style=text-align:left>Data</th><th style=text-align:left>Data Type</th><th style=text-align:left>Use</th><th style=text-align:left>Default Value</th></tr></thead><tbody><tr><td style=text-align:left><a href=/specification/syntax/constraints/#id><code>@id</code></a></td><td style=text-align:left><a href=/specification/datatypes/#token><code>token</code></a></td><td style=text-align:left>optional</td><td style=text-align:left><em>(no default)</em></td></tr><tr><td style=text-align:left><a href=/specification/syntax/constraints/#level><code>@level</code></a></td><td style=text-align:left><code>DEBUG</code>,<code>INFORMATIONAL</code>, <code>WARNING</code>, <code>ERROR</code>, or <code>CRITICAL</code></td><td style=text-align:left>optional</td><td style=text-align:left><code>ERROR</code></td></tr><tr><td style=text-align:left><a href=/specification/syntax/constraints/#target><code>@target</code></a></td><td style=text-align:left><a href=/specification/syntax/metapath/>metapath</a></td><td style=text-align:left><em>(varies)</em></td><td style=text-align:left><em>(no default)</em></td></tr><tr><td style=text-align:left><code>@test</code></td><td style=text-align:left><a href=/specification/syntax/metapath/>metapath</a></td><td style=text-align:left>required</td><td style=text-align:left><em>(no default)</em></td></tr><tr><td style=text-align:left><a href=/specification/syntax/constraints/#formal-name><code>&lt;formal-name></code></a></td><td style=text-align:left><a href=/specification/datatypes/#string><code>string</code></a></td><td style=text-align:left>0 or 1</td><td style=text-align:left><em>(no default)</em></td></tr><tr><td style=text-align:left><a href=/specification/syntax/constraints/#description><code>&lt;description></code></a></td><td style=text-align:left><a href=/specification/datatypes/#markup-line><code>markup-line</code></a></td><td style=text-align:left>0 or 1</td><td style=text-align:left><em>(no default)</em></td></tr><tr><td style=text-align:left><a href=/specification/syntax/constraints/#prop><code>&lt;prop></code></a></td><td style=text-align:left>(structured)</td><td style=text-align:left>0 to âˆž</td><td style=text-align:left><em>(no default)</em></td></tr><tr><td style=text-align:left><a href=/specification/syntax/constraints/#constraint-messages><code>&lt;message></code></a></td><td style=text-align:left><a href=/specification/syntax/constraints/#constraint-messages>template</a></td><td style=text-align:left>0 or 1</td><td style=text-align:left><em>(no default)</em></td></tr><tr><td style=text-align:left><a href=/specification/syntax/constraints/#remarks><code>&lt;remarks></code></a></td><td style=text-align:left>(structured)</td><td style=text-align:left>0 or 1</td><td style=text-align:left><em>(no default)</em></td></tr></tbody></table><p>The <code>@target</code> attribute of an <code>&lt;expect></code> constraint is a <a href=/specification/syntax/metapath/>Metapath expression</a> that specifies the node(s) in a document instance whose value is restricted by the constraint.</p><p>A <code>@target</code> is REQUIRED for expect constraints associated with a field and assembly. A <code>@target</code> MUST NOT be provided for an expect constraint associated with a flag, since such a constraint can only target the flag&rsquo;s value. In flag use cases the <code>@target</code> MUST be considered <code>.</code>, referring to the flag node.</p><p>The <code>@test</code> attribute of an <code>&lt;expect></code> constraint specifies the logical condition to be evaluated against each value node resulting from evaluating the <code>@target</code>. This expression MUST evaluate to <a href=/specification/datatypes/#boolean>a Metaschema boolean value</a> <code>true</code> or <code>false</code>.</p><p>When the <code>@test</code> expression evaluates to <code>true</code> for a target value node, then the target value node MUST be considered valid and passing the constraint.</p><p>When the <code>@test</code> expression evaluates to <code>false</code> for a target value node, then the target value node MUST be considered not valid and failing the constraint.</p><p>A constraint may have an OPTIONAL <a href=/specification/syntax/constraints/#level><code>@level</code></a> attribute and/or an OPTIONAL child <a href=/specification/syntax/constraints/#constraint-messages><code>&lt;message></code></a> element to indicate severity and provide documentation explaining how the target nodes are invalid.</p><h3 id=has-cardinality-constraints><a href=#has-cardinality-constraints><code>has-cardinality</code> Constraints</a></h3><p>The <code>has-cardinality</code> constraint is a type of Metaschema constraint that defines the cardinality of assemblies, flags, and, fields, i.e. the required minimum count of occurrences, the maximum count of occurrences, or both for applicable document instances.</p><p>The syntax of <code>&lt;has-cardinality></code> consists of the following:</p><table><thead><tr><th style=text-align:left>Data</th><th style=text-align:left>Data Type</th><th style=text-align:left>Use</th><th style=text-align:left>Default Value</th></tr></thead><tbody><tr><td style=text-align:left><a href=/specification/syntax/constraints/#id><code>@id</code></a></td><td style=text-align:left><a href=/specification/datatypes/#token><code>token</code></a></td><td style=text-align:left>optional</td><td style=text-align:left><em>(no default)</em></td></tr><tr><td style=text-align:left><a href=/specification/syntax/constraints/#level><code>@level</code></a></td><td style=text-align:left><code>DEBUG</code>,<code>INFORMATIONAL</code>, <code>WARNING</code>, <code>ERROR</code>, or <code>CRITICAL</code></td><td style=text-align:left>optional</td><td style=text-align:left><code>ERROR</code></td></tr><tr><td style=text-align:left><a href=/specification/syntax/constraints/#target><code>@target</code></a></td><td style=text-align:left><a href=/specification/syntax/metapath/>metapath</a></td><td style=text-align:left><em>(varies)</em></td><td style=text-align:left><em>(no default)</em></td></tr><tr><td style=text-align:left><code>@min-occurs</code></td><td style=text-align:left><a href=/specification/datatypes/#non-negative-integer><code>non-negative-integer</code></a></td><td style=text-align:left>optional</td><td style=text-align:left><em>(no default)</em></td></tr><tr><td style=text-align:left><code>@max-occurs</code></td><td style=text-align:left><a href=/specification/datatypes/#non-negative-integer><code>non-negative-integer</code></a> or <code>unbounded</code></td><td style=text-align:left>optional</td><td style=text-align:left><em>(no default)</em></td></tr><tr><td style=text-align:left><a href=/specification/syntax/constraints/#formal-name><code>&lt;formal-name></code></a></td><td style=text-align:left><a href=/specification/datatypes/#string><code>string</code></a></td><td style=text-align:left>0 or 1</td><td style=text-align:left><em>(no default)</em></td></tr><tr><td style=text-align:left><a href=/specification/syntax/constraints/#description><code>&lt;description></code></a></td><td style=text-align:left><a href=/specification/datatypes/#markup-line><code>markup-line</code></a></td><td style=text-align:left>0 or 1</td><td style=text-align:left><em>(no default)</em></td></tr><tr><td style=text-align:left><a href=/specification/syntax/constraints/#prop><code>&lt;prop></code></a></td><td style=text-align:left>(structured)</td><td style=text-align:left>0 to âˆž</td><td style=text-align:left><em>(no default)</em></td></tr><tr><td style=text-align:left><a href=/specification/syntax/constraints/#constraint-messages><code>&lt;message></code></a></td><td style=text-align:left><a href=/specification/syntax/constraints/#constraint-messages>template</a></td><td style=text-align:left>0 or 1</td><td style=text-align:left><em>(no default)</em></td></tr><tr><td style=text-align:left><a href=/specification/syntax/constraints/#remarks><code>&lt;remarks></code></a></td><td style=text-align:left>(structured)</td><td style=text-align:left>0 or 1</td><td style=text-align:left><em>(no default)</em></td></tr></tbody></table><p>The <code>@target</code> flag of an <code>&lt;has-cardinality></code> constraint is a <a href=/specification/syntax/metapath/>Metapath expression</a> that defines the node(s) in a document instance to count.</p><p>The constraint MUST define a <a href=/specification/syntax/constraints/#target><code>@target</code></a> with a Metapath expression. The processor MUST only count the document instance node(s) resulting from its evaluation.</p><p>A constraint MUST define a value for either the <code>@min-occurs</code> or <code>@max-occurs</code> flag. It MAY optionally have both flags defined.</p><p>The <code>@min-occurs</code> flag MUST be an integer that defines the minimum number of required occurrences for results matching the evaluation of the <code>@target</code>.</p><p>The <code>@max-occurs</code> flag MUST be an integer that defines the maximum number of required occurrences for results matching the evaluation of the <code>@target</code>.</p><p>A constraint passes and document instance(s) valid if the count of results matching the evaluation of the <code>@target</code> Metapath is equal or more than the value of <code>@min-occurs</code>, if defined, and equal to or less than the value of <code>@max-occurs</code>, if defined. If these requirements are not met when defined, the constraint is not passing and the document instance(s) are not valid.</p><h3 id=index-constraints><a href=#index-constraints><code>index</code> Constraints</a></h3><p>The <code>&lt;index></code> constraint is a type of Metaschema constraint that defines an index of document instance nodes addressable by key.</p><p>The syntax of <code>&lt;index></code> consists of the following:</p><table><thead><tr><th style=text-align:left>Data</th><th style=text-align:left>Data Type</th><th style=text-align:left>Use</th><th style=text-align:left>Default Value</th></tr></thead><tbody><tr><td style=text-align:left><a href=/specification/syntax/constraints/#id><code>@id</code></a></td><td style=text-align:left><a href=/specification/datatypes/#token><code>token</code></a></td><td style=text-align:left>optional</td><td style=text-align:left><em>(no default)</em></td></tr><tr><td style=text-align:left><a href=/specification/syntax/constraints/#level><code>@level</code></a></td><td style=text-align:left><code>DEBUG</code>,<code>INFORMATIONAL</code>, <code>WARNING</code>, <code>ERROR</code>, or <code>CRITICAL</code></td><td style=text-align:left>optional</td><td style=text-align:left><code>ERROR</code></td></tr><tr><td style=text-align:left><code>@name</code></td><td style=text-align:left><a href=/specification/datatypes/#token><code>token</code></a></td><td style=text-align:left>required</td><td style=text-align:left><em>(no default)</em></td></tr><tr><td style=text-align:left><a href=/specification/syntax/constraints/#target><code>@target</code></a></td><td style=text-align:left><a href=/specification/syntax/metapath/>metapath</a></td><td style=text-align:left>required</td><td style=text-align:left><em>(no default)</em></td></tr><tr><td style=text-align:left><a href=/specification/syntax/constraints/#formal-name><code>&lt;formal-name></code></a></td><td style=text-align:left><a href=/specification/datatypes/#string><code>string</code></a></td><td style=text-align:left>0 or 1</td><td style=text-align:left><em>(no default)</em></td></tr><tr><td style=text-align:left><a href=/specification/syntax/constraints/#description><code>&lt;description></code></a></td><td style=text-align:left><a href=/specification/datatypes/#markup-line><code>markup-line</code></a></td><td style=text-align:left>0 or 1</td><td style=text-align:left><em>(no default)</em></td></tr><tr><td style=text-align:left><a href=/specification/syntax/constraints/#prop><code>&lt;prop></code></a></td><td style=text-align:left>(structured)</td><td style=text-align:left>0 to âˆž</td><td style=text-align:left><em>(no default)</em></td></tr><tr><td style=text-align:left><code>&lt;key-field></code></td><td style=text-align:left>(structured)</td><td style=text-align:left>1 to âˆž</td><td style=text-align:left><em>(no default)</em></td></tr><tr><td style=text-align:left><a href=/specification/syntax/constraints/#constraint-messages><code>&lt;message></code></a></td><td style=text-align:left><a href=/specification/syntax/constraints/#constraint-messages>template</a></td><td style=text-align:left>0 or 1</td><td style=text-align:left><em>(no default)</em></td></tr><tr><td style=text-align:left><a href=/specification/syntax/constraints/#remarks><code>&lt;remarks></code></a></td><td style=text-align:left>(structured)</td><td style=text-align:left>0 or 1</td><td style=text-align:left><em>(no default)</em></td></tr></tbody></table><p>The syntax of <code>&lt;key-field></code> consists of the following:</p><table><thead><tr><th style=text-align:left>Data</th><th style=text-align:left>Data Type</th><th style=text-align:left>Use</th><th style=text-align:left>Default Value</th></tr></thead><tbody><tr><td style=text-align:left><code>@target</code></td><td style=text-align:left><a href=/specification/syntax/metapath/>metapath</a></td><td style=text-align:left>required</td><td style=text-align:left><em>(no default)</em></td></tr><tr><td style=text-align:left><code>@pattern</code></td><td style=text-align:left>regex</td><td style=text-align:left>optional</td><td style=text-align:left><em>(no default)</em></td></tr><tr><td style=text-align:left><code>&lt;remarks></code></td><td style=text-align:left>(structured)</td><td style=text-align:left>0 or 1</td><td style=text-align:left><em>(no default)</em></td></tr></tbody></table><p>The <code>@name</code> flag of an <code>&lt;index></code> constraint specifies the identity of the index. The constraint MUST define the name.</p><p>The <code>@target</code> flag of an <code>&lt;index></code> constraint defines the node(s) in a document instance to index. The index MUST define a <a href=/specification/syntax/constraints/#target><code>@target</code></a> with a <a href=/specification/syntax/metapath/>Metapath expression</a>. The processor MUST index only the node(s) resulting from evaluating the <code>@target</code>.</p><p>The <code>&lt;key-field></code> assembly of an <code>&lt;index></code> constraint defines the flag or field value that is the key for each entry in the index. A <code>&lt;key-field></code> assembly MUST define at least one <a href=/specification/syntax/constraints/#target><code>@target</code></a> flag with a Metapath expression evaluated relative to <a href=/specification/syntax/constraints/#constraint-processing>the evaluation focus</a> using each node that matches the constraint&rsquo;s <code>@target</code>.</p><p>An <code>&lt;index></code> constraint MAY define more than one <code>&lt;key-field></code> assembly. The composite key for each entry in the index is the combination of values for the <code>@target</code> of every <code>&lt;key-field/></code>. The composite values of the key are the discriminator for the uniqueness of the index entry.</p><p>An <code>&lt;index></code> constraint requires that each member entry be unique based upon this composite key.</p><p>If the evaluation of the Metapath <code>@target</code> of the <code>&lt;key-field/></code> does not result in a value, its value for that key in the index is null.</p><p>If two entries have the same key computed from the <code>&lt;key-field></code> <code>@target</code>s when generating the index, the processor MUST return a processing error.</p><h3 id=index-has-key-constraints><a href=#index-has-key-constraints><code>index-has-key</code> Constraints</a></h3><p>The <code>&lt;index-has-key></code> constraint is a type of Metaschema constraint that checks if a value is a valid cross-reference to values in an existing <code>index</code> constraint`.</p><p>The <code>index-has-key</code> constraint has the same flags and assemblies as a <a href=/specification/syntax/constraints/#index-constraints><code>index</code></a> constraint.</p><p>The <code>@target</code> flag of an <code>&lt;index-has-key></code> constraint defines the node(s) in a document instance to check as a cross-reference. The index MUST define a <a href=/specification/syntax/constraints/#target><code>@target</code></a> with a <a href=/specification/syntax/metapath/>Metapath expression</a> to identify the nodes to check. The processor MUST only check the node(s) resulting from evaluating the <code>@target</code>.</p><p>Similar to an <code>&lt;index></code> constraint, the <code>&lt;key-field/></code> assembly is used to compute the cross-reference&rsquo;s key.</p><p>The <code>@name</code> flag of an <code>&lt;index></code> constraint MUST specify the name of a previously defined <code>index</code> constraint.</p><h3 id=is-unique-constraints><a href=#is-unique-constraints><code>is-unique</code> Constraints</a></h3><p>The <code>&lt;is-unique></code> constraint is a type of Metaschema constraint that checks that a computed key, based on field and flag values, does not occur more than once. Unlike <code>&lt;index></code>, an explicit, named index is not created. Therefore, this constraint MUST NOT define a <code>@name</code> flag.</p><p>The <code>index-has-key</code> constraint has the same flags and assemblies as a <a href=/specification/syntax/constraints/#index-constraints><code>index</code></a> constraint, except it doesn&rsquo;t have a <code>@name</code>.</p><p>The <a href=/specification/syntax/constraints/#id><code>id</code></a> flag of an <code>&lt;is-unique></code> constraint specifies an identifier for the constraint.</p><p>The <code>@target</code> flag of an <code>&lt;is-unique></code> constraint identifies the node(s) in a document instance to check for uniqueness. The <code>&lt;is-unique></code> MUST define a <a href=/specification/syntax/constraints/#target><code>@target</code></a> with a Metapath expression. The processor MUST check uniqueness for only the node(s) resulting from evaluating the <code>@target</code>.</p><p>A <code>&lt;key-field></code> assembly of an <code>&lt;is-unique></code> constraint identifies the flag or field value that is the key used to determine the uniqueness of each entry based on a computed key. A <code>&lt;key-field></code> element MUST define at least one <a href=/specification/syntax/constraints/#target><code>@target</code></a> flag with a Metapath expression evaluated relative to <a href=/specification/syntax/constraints/#constraint-processing>the evaluation focus</a> using each node that matches the constraint&rsquo;s <code>@target</code>.</p><p>An <code>is-unique</code> constraint MAY define more than one <code>&lt;key-field></code> assembly. The composite key for each entry in the index is the combination of values for the <code>@target</code> of every <code>&lt;key-field/></code>. The composite values of the key are the discriminator for the uniqueness of the index entry.</p><p>When evaluating a given key relative to other computed keys for the same constraint, if the given key has the same computed key value as another node matching the same constraint, then the target node MUST be considered to not pass the constraint.</p><h3 id=matches-constraints><a href=#matches-constraints><code>matches</code> Constraints</a></h3><p>The <code>&lt;matches></code> constraint is a type of Metaschema constraint that restricts field or flag value(s) based on node(s) matching the target Metapath expression. Each one of these are discussed below.</p><p>The syntax of <code>&lt;matches></code> consists of the following:</p><table><thead><tr><th style=text-align:left>Data</th><th style=text-align:left>Data Type</th><th style=text-align:left>Use</th><th style=text-align:left>Default Value</th></tr></thead><tbody><tr><td style=text-align:left><a href=/specification/syntax/constraints/#id><code>@id</code></a></td><td style=text-align:left><a href=/specification/datatypes/#token><code>token</code></a></td><td style=text-align:left>optional</td><td style=text-align:left><em>(no default)</em></td></tr><tr><td style=text-align:left><a href=/specification/syntax/constraints/#level><code>@level</code></a></td><td style=text-align:left><code>DEBUG</code>,<code>INFORMATIONAL</code>, <code>WARNING</code>, <code>ERROR</code>, or <code>CRITICAL</code></td><td style=text-align:left>optional</td><td style=text-align:left><code>ERROR</code></td></tr><tr><td style=text-align:left><code>@datatype</code></td><td style=text-align:left><a href=/specification/datatypes/>data type name</a></td><td style=text-align:left>optional</td><td style=text-align:left><em>(no default)</em></td></tr><tr><td style=text-align:left><code>@regex</code></td><td style=text-align:left>regex</td><td style=text-align:left>optional</td><td style=text-align:left><em>(no default)</em></td></tr><tr><td style=text-align:left><a href=/specification/syntax/constraints/#target><code>@target</code></a></td><td style=text-align:left><a href=/specification/syntax/metapath/>metapath</a></td><td style=text-align:left><em>(varies)</em></td><td style=text-align:left><em>(no default)</em></td></tr><tr><td style=text-align:left><a href=/specification/syntax/constraints/#formal-name><code>&lt;formal-name></code></a></td><td style=text-align:left><a href=/specification/datatypes/#string><code>string</code></a></td><td style=text-align:left>0 or 1</td><td style=text-align:left><em>(no default)</em></td></tr><tr><td style=text-align:left><a href=/specification/syntax/constraints/#description><code>&lt;description></code></a></td><td style=text-align:left><a href=/specification/datatypes/#markup-line><code>markup-line</code></a></td><td style=text-align:left>0 or 1</td><td style=text-align:left><em>(no default)</em></td></tr><tr><td style=text-align:left><a href=/specification/syntax/constraints/#prop><code>&lt;prop></code></a></td><td style=text-align:left>(structured)</td><td style=text-align:left>0 to âˆž</td><td style=text-align:left><em>(no default)</em></td></tr><tr><td style=text-align:left><a href=/specification/syntax/constraints/#constraint-messages><code>&lt;message></code></a></td><td style=text-align:left><a href=/specification/syntax/constraints/#constraint-messages>template</a></td><td style=text-align:left>0 or 1</td><td style=text-align:left><em>(no default)</em></td></tr><tr><td style=text-align:left><a href=/specification/syntax/constraints/#remarks><code>&lt;remarks></code></a></td><td style=text-align:left>(structured)</td><td style=text-align:left>0 or 1</td><td style=text-align:left><em>(no default)</em></td></tr></tbody></table><p>A match can be made by 2 different ways based on <code>@datatype</code> and/or based on <code>@regex</code>.</p><p>The <code>@target</code> flag of an <code>matches</code> constraint specifies the node(s) in a document instance whose value matches the <code>@datatype</code> and/or the <code>@regex</code>.</p><p>A <code>@target</code> is REQUIRED for matches constraints associated with a field and assembly. A <code>@target</code> MUST NOT be provided for a matches constraint associated with a flag, since such a constraint can only target the flag&rsquo;s value. In flag use cases the <code>@target</code> MUST be considered <code>.</code>, referring to the flag node.</p><p>The <code>matches</code> constraint MUST define a <a href=/specification/syntax/constraints/#target><code>target</code></a> with a Metapath expression. The processor MUST evaluate only the node(s) resulting from evaluating the <code>@target</code>.</p><p>If a <code>@datatype</code> is provided, each resulting node&rsquo;s value MUST match the syntax of the given <code>@datatype</code>.</p><p>If a <code>@regex</code> is provided, each resulting node&rsquo;s value MUST match the pattern specified by the given <code>@regex</code>.</p><p>When evaluating node(s) matching the <code>@target</code>, the node(s) pass the constraint when matching all requirements of <code>@datatype</code>, if defined, and <code>@regex</code>, if defined.</p><p>If the node(s) do not match any of these requirements, then the node(s) MUST be considered to not pass the constraint.</p><h3 id=report-constraints><a href=#report-constraints><code>report</code> Constraints</a></h3><p>The <code>&lt;report></code> constraint is a type of Metaschema constraint that reports information about field or flag value(s) based on the evaluation of a <code>@test</code> Metapath expression. This constraint is semantically the inverse of the <a href=/specification/syntax/constraints/#expect-constraints><code>&lt;expect></code></a> constraint.</p><p>While <code>&lt;expect></code> constraints are used to assert requirements that <em>must</em> be met (test returns <code>true</code> = pass), <code>&lt;report></code> constraints are used to identify conditions that <em>should be reported</em> when they occur (test returns <code>true</code> = report). This allows constraint authors to express positive conditions directly, without needing to invert the logic.</p><p>The syntax of <code>&lt;report></code> consists of the following:</p><table><thead><tr><th style=text-align:left>Data</th><th style=text-align:left>Data Type</th><th style=text-align:left>Use</th><th style=text-align:left>Default Value</th></tr></thead><tbody><tr><td style=text-align:left><a href=/specification/syntax/constraints/#id><code>@id</code></a></td><td style=text-align:left><a href=/specification/datatypes/#token><code>token</code></a></td><td style=text-align:left>optional</td><td style=text-align:left><em>(no default)</em></td></tr><tr><td style=text-align:left><a href=/specification/syntax/constraints/#level><code>@level</code></a></td><td style=text-align:left><code>DEBUG</code>,<code>INFORMATIONAL</code>, <code>WARNING</code>, <code>ERROR</code>, or <code>CRITICAL</code></td><td style=text-align:left>optional</td><td style=text-align:left><code>ERROR</code></td></tr><tr><td style=text-align:left><a href=/specification/syntax/constraints/#target><code>@target</code></a></td><td style=text-align:left>special</td><td style=text-align:left><em>(varies)</em></td><td style=text-align:left><em>(no default)</em></td></tr><tr><td style=text-align:left><code>@test</code></td><td style=text-align:left>special</td><td style=text-align:left>required</td><td style=text-align:left><em>(no default)</em></td></tr><tr><td style=text-align:left><a href=/specification/syntax/constraints/#formal-name><code>&lt;formal-name></code></a></td><td style=text-align:left><a href=/specification/datatypes/#string><code>string</code></a></td><td style=text-align:left>0 or 1</td><td style=text-align:left><em>(no default)</em></td></tr><tr><td style=text-align:left><a href=/specification/syntax/constraints/#description><code>&lt;description></code></a></td><td style=text-align:left><a href=/specification/datatypes/#markup-line><code>markup-line</code></a></td><td style=text-align:left>0 or 1</td><td style=text-align:left><em>(no default)</em></td></tr><tr><td style=text-align:left><a href=/specification/syntax/constraints/#prop><code>&lt;prop></code></a></td><td style=text-align:left>special</td><td style=text-align:left>0 to âˆž</td><td style=text-align:left><em>(no default)</em></td></tr><tr><td style=text-align:left><code>&lt;message></code></td><td style=text-align:left>special</td><td style=text-align:left>0 or 1</td><td style=text-align:left><em>(no default)</em></td></tr><tr><td style=text-align:left><a href=/specification/syntax/constraints/#remarks><code>&lt;remarks></code></a></td><td style=text-align:left>special</td><td style=text-align:left>0 or 1</td><td style=text-align:left><em>(no default)</em></td></tr></tbody></table><p>The <code>@target</code> attribute of a <code>&lt;report></code> constraint is a <a href=/specification/syntax/metapath/>Metapath expression</a> that specifies the node(s) in a document instance whose value is evaluated by the constraint.</p><p>A <code>@target</code> is REQUIRED for report constraints associated with a field and assembly. A <code>@target</code> MUST NOT be provided for a report constraint associated with a flag, since such a constraint can only target the flag&rsquo;s value. In flag use cases the <code>@target</code> MUST be considered <code>.</code>, referring to the flag node.</p><p>The <code>@test</code> attribute of a <code>&lt;report></code> constraint specifies the condition to be evaluated against each value node resulting from evaluating the <code>@target</code>. This expression MUST evaluate to <a href=/specification/datatypes/#boolean>a Metaschema boolean value</a> <code>true</code> or <code>false</code>.</p><p>When the <code>@test</code> expression evaluates to <code>true</code> for a target value node, then the condition has been met and MUST be reported.</p><p>When the <code>@test</code> expression evaluates to <code>false</code> for a target value node, then the condition has not been met and no reporting is required.</p><p>A constraint may have an OPTIONAL <a href=/specification/syntax/constraints/#level><code>@level</code></a> attribute and/or an OPTIONAL child <code>&lt;message></code> element to indicate severity and documentation explaining the reported condition.</p><p>If defined, the <code>&lt;message></code> value MUST be a <a href=/specification/datatypes/#string>Metaschema string value</a>. It MAY contain a Metapath expression templates that starts with <code>{</code>, contains a Metapath expression, and ends with <code>}</code>. When evaluating a template Metapath expression, the context of the Metapath <a href=/specification/syntax/constraints/#constraint-processing>evaluation focus</a> MUST be the reported value node.</p><h4 id=expect-vs-report-comparison><a href=#expect-vs-report-comparison><code>expect</code> vs <code>report</code> Comparison</a></h4><p>The following table illustrates the semantic difference between <code>&lt;expect></code> and <code>&lt;report></code> constraints:</p><table><thead><tr><th style=text-align:left>Constraint</th><th style=text-align:left>Test Result</th><th style=text-align:left>Outcome</th></tr></thead><tbody><tr><td style=text-align:left><code>&lt;expect></code></td><td style=text-align:left><code>true</code></td><td style=text-align:left>Constraint passes (no violation)</td></tr><tr><td style=text-align:left><code>&lt;expect></code></td><td style=text-align:left><code>false</code></td><td style=text-align:left>Constraint fails (violation reported)</td></tr><tr><td style=text-align:left><code>&lt;report></code></td><td style=text-align:left><code>true</code></td><td style=text-align:left>Condition met (information reported)</td></tr><tr><td style=text-align:left><code>&lt;report></code></td><td style=text-align:left><code>false</code></td><td style=text-align:left>Condition not met (nothing reported)</td></tr></tbody></table><p>For example, to report when a deprecated field is used:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;define-field</span> <span class=na>name=</span><span class=s>&#34;legacy-field&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;constraint&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;report</span> <span class=na>test=</span><span class=s>&#34;exists(.)&#34;</span> <span class=na>level=</span><span class=s>&#34;WARNING&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;message&gt;</span>The &#39;legacy-field&#39; is deprecated and will be removed in a future version.<span class=nt>&lt;/message&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/report&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/constraint&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/define-field&gt;</span>
</span></span></code></pre></div><p>The equivalent using <code>&lt;expect></code> would require inverting the logic:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;define-field</span> <span class=na>name=</span><span class=s>&#34;legacy-field&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;constraint&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;expect</span> <span class=na>test=</span><span class=s>&#34;not(exists(.))&#34;</span> <span class=na>level=</span><span class=s>&#34;WARNING&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;message&gt;</span>The &#39;legacy-field&#39; is deprecated and will be removed in a future version.<span class=nt>&lt;/message&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/expect&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/constraint&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/define-field&gt;</span>
</span></span></code></pre></div><p>The <code>&lt;report></code> constraint allows the condition to be expressed more naturally and clearly.</p><h2 id=constraint-processing><a href=#constraint-processing>Constraint Processing</a></h2><p>In a Metaschema-based document instance, each node in the document instance is associated with a definition in a Metaschema module. Thus, a given content node has one and only one associated definition.</p><p>A constraint is defined relative to an assembly, field, or flag <a href=../definitions/>definition</a> in a Metaschema module.</p><p>All constraints associated with a definition MUST be evaluated against all associated content nodes.</p><p>Constraints may be declared internally within a definition or as an external set of constraints associated with a definition. To determine the evaluation order, internal and external constraints associated with a definition need to be combined.</p><p>Declaration order MUST be determined in the following way.</p><ol><li>Internal constraints defined directly in the definition are ordered first according to their original order.</li><li>External constraints are appended in the order the external constraints were provided to the processor.</li></ol><p>Each constraint MUST be evaluated in declaration order.</p><p>For example:</p><p>Given the Metaschema module definitions below:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Assembly(name=&#34;asmA&#34;)
</span></span><span class=line><span class=cl>  Field(name=&#34;fldX)
</span></span><span class=line><span class=cl>    Flag(name=&#34;flgS&#34;)
</span></span><span class=line><span class=cl>  Assembly(name=&#34;asmB&#34;)
</span></span><span class=line><span class=cl>    Flag(name=&#34;flgT&#34;)
</span></span></code></pre></div><p>Constraint evaluation would be handled depth-first as follows:</p><ul><li>When document node <code>asmA</code> is processed, constraints defined on that node&rsquo;s definition will be evaluated.</li><li>When document node <code>fldX</code> is processed, constraints defined on that node&rsquo;s definition will be evaluated.</li><li>and so on&mldr;</li></ul><p>Note: The target of the constraint does not affect this evaluation order, but may affect what resulting node the constraint applies to.</p><p>When a constraint is evaluated against the associated content node, this node is considered the constraints <em>evaluation focus</em>.</p><h3 id=processing-error-handling><a href=#processing-error-handling>Processing Error Handling</a></h3><p>Processing errors occur when a defect in the constraint definition causes an unintended error to occur during constraint processing. This differs from a validation error that results from not meeting the requirement of a constraint.</p><ul><li>If a processing error occurs while processing a constraint, which can result from evaluating a Metapath expression, the error SHOULD be reported.</li><li>If a processing error occurs while processing a constraint, then the document instance being validated MUST NOT be considered valid. This is due to the inability to make a conclusion around validity, since some constraints were not validated due to errors.</li></ul><h2 id=external-constraints><a href=#external-constraints>External Constraints</a></h2><p><em>External constraints</em> provide a mechanism to define constraint rules that are applied to existing Metaschema module-based models without modifying the original module definitions. This enables validation rules to be managed separately from the base model definitions.</p><p>The <code>&lt;metaschema-meta-constraints></code> root element defines constraint rules using Metapath-based context selection to target nodes within document instances.</p><h3 id=metaschema-meta-constraints><a href=#metaschema-meta-constraints><code>&lt;metaschema-meta-constraints></code></a></h3><p>The <code>&lt;metaschema-meta-constraints></code> element defines constraint rules to be applied to an existing set of Metaschema module-based models.</p><table><thead><tr><th style=text-align:left>Data</th><th style=text-align:left>Data Type</th><th style=text-align:left>Use</th><th style=text-align:left>Default Value</th></tr></thead><tbody><tr><td style=text-align:left><a href=/specification/syntax/constraints/#import-1><code>&lt;import></code></a></td><td style=text-align:left>(structured)</td><td style=text-align:left>0 to âˆž</td><td style=text-align:left><em>(no default)</em></td></tr><tr><td style=text-align:left><a href=/specification/syntax/constraints/#namespace-binding><code>&lt;namespace-binding></code></a></td><td style=text-align:left>(structured)</td><td style=text-align:left>0 to âˆž</td><td style=text-align:left><em>(no default)</em></td></tr><tr><td style=text-align:left><a href=/specification/syntax/constraints/#definition-context><code>&lt;definition-context></code></a></td><td style=text-align:left>(structured)</td><td style=text-align:left>0 or 1</td><td style=text-align:left><em>(no default)</em></td></tr><tr><td style=text-align:left><a href=/specification/syntax/constraints/#context><code>&lt;context></code></a></td><td style=text-align:left>(structured)</td><td style=text-align:left>1 to âˆž</td><td style=text-align:left><em>(no default)</em></td></tr></tbody></table><p>A <code>&lt;metaschema-meta-constraints></code> document MUST contain at least one <code>&lt;context></code> element.</p><div id=tabs-9 class="codetabs usa-accordion"><ul><li class=codetab><button class=usa-accordion__button aria-expanded=true aria-controls=tabs-9-xml-tab><span>XML</span></button></li><li class=codetab><button class=usa-accordion__button aria-expanded=true aria-controls=tabs-9-json-tab><span>JSON</span></button></li><li class=codetab><button class=usa-accordion__button aria-expanded=true aria-controls=tabs-9-yaml-tab><span>YAML</span></button></li></ul><div id=tabs-9-content class=codetab-content><div id=tabs-9-xml-tab class=codetab-content-item><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=cp>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;metaschema-meta-constraints</span>
</span></span><span class=line><span class=cl>    <span class=na>xmlns=</span><span class=s>&#34;http://csrc.nist.gov/ns/oscal/metaschema/1.0&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;context&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;metapath</span> <span class=na>target=</span><span class=s>&#34;/catalog/metadata&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;constraints&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;expect</span> <span class=na>test=</span><span class=s>&#34;exists(title)&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;message&gt;</span>Metadata must have a title.<span class=nt>&lt;/message&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;/expect&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/constraints&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/context&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/metaschema-meta-constraints&gt;</span>
</span></span></code></pre></div></div><div id=tabs-9-json-tab class=codetab-content-item><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;metaschema-meta-constraints&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;contexts&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;metapaths&#34;</span><span class=p>:</span> <span class=p>[{</span> <span class=nt>&#34;target&#34;</span><span class=p>:</span> <span class=s2>&#34;/catalog/metadata&#34;</span> <span class=p>}],</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;constraints&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;expect&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;test&#34;</span><span class=p>:</span> <span class=s2>&#34;exists(title)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;message&#34;</span><span class=p>:</span> <span class=s2>&#34;Metadata must have a title.&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div></div><div id=tabs-9-yaml-tab class=codetab-content-item><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>metaschema-meta-constraints</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>contexts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>metapaths</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>target</span><span class=p>:</span><span class=w> </span><span class=l>/catalog/metadata</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>constraints</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>expect</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=nt>test</span><span class=p>:</span><span class=w> </span><span class=l>exists(title)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>message</span><span class=p>:</span><span class=w> </span><span class=l>Metadata must have a title.</span><span class=w>
</span></span></span></code></pre></div></div></div></div><h3 id=import-1><a href=#import-1><code>&lt;import></code></a></h3><p>The <code>&lt;import></code> element declares a set of Metaschema constraints from an out-of-line resource to import, supporting composition of constraint sets.</p><table><thead><tr><th style=text-align:left>Data</th><th style=text-align:left>Data Type</th><th style=text-align:left>Use</th><th style=text-align:left>Default Value</th></tr></thead><tbody><tr><td style=text-align:left><code>@href</code></td><td style=text-align:left><a href=/specification/datatypes/#uri-reference><code>uri-reference</code></a></td><td style=text-align:left>required</td><td style=text-align:left><em>(no default)</em></td></tr></tbody></table><p>The <code>@href</code> attribute MUST contain a relative or absolute URI for retrieving an out-of-line Metaschema constraint definition.</p><div id=tabs-10 class="codetabs usa-accordion"><ul><li class=codetab><button class=usa-accordion__button aria-expanded=true aria-controls=tabs-10-xml-tab><span>XML</span></button></li><li class=codetab><button class=usa-accordion__button aria-expanded=true aria-controls=tabs-10-json-tab><span>JSON</span></button></li><li class=codetab><button class=usa-accordion__button aria-expanded=true aria-controls=tabs-10-yaml-tab><span>YAML</span></button></li></ul><div id=tabs-10-content class=codetab-content><div id=tabs-10-xml-tab class=codetab-content-item><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;import</span> <span class=na>href=</span><span class=s>&#34;./additional-constraints.xml&#34;</span><span class=nt>/&gt;</span>
</span></span></code></pre></div></div><div id=tabs-10-json-tab class=codetab-content-item><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;imports&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span> <span class=nt>&#34;href&#34;</span><span class=p>:</span> <span class=s2>&#34;./additional-constraints.json&#34;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div></div><div id=tabs-10-yaml-tab class=codetab-content-item><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>imports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>href</span><span class=p>:</span><span class=w> </span><span class=l>./additional-constraints.yaml</span><span class=w>
</span></span></span></code></pre></div></div></div></div><h3 id=namespace-binding><a href=#namespace-binding><code>&lt;namespace-binding></code></a></h3><p>The <code>&lt;namespace-binding></code> element assigns a Metapath namespace to a prefix for use in <a href=/specification/syntax/metapath/>Metapath expressions</a> within lexical qualified names.</p><table><thead><tr><th style=text-align:left>Data</th><th style=text-align:left>Data Type</th><th style=text-align:left>Use</th><th style=text-align:left>Default Value</th></tr></thead><tbody><tr><td style=text-align:left><code>@uri</code></td><td style=text-align:left><a href=/specification/datatypes/#uri><code>uri</code></a></td><td style=text-align:left>required</td><td style=text-align:left><em>(no default)</em></td></tr><tr><td style=text-align:left><code>@prefix</code></td><td style=text-align:left><a href=/specification/datatypes/#token><code>token</code></a></td><td style=text-align:left>required</td><td style=text-align:left><em>(no default)</em></td></tr></tbody></table><p>The <code>@uri</code> attribute MUST contain the namespace URI to bind to the prefix.</p><p>The <code>@prefix</code> attribute MUST contain the prefix that is bound to the namespace.</p><div id=tabs-11 class="codetabs usa-accordion"><ul><li class=codetab><button class=usa-accordion__button aria-expanded=true aria-controls=tabs-11-xml-tab><span>XML</span></button></li><li class=codetab><button class=usa-accordion__button aria-expanded=true aria-controls=tabs-11-json-tab><span>JSON</span></button></li><li class=codetab><button class=usa-accordion__button aria-expanded=true aria-controls=tabs-11-yaml-tab><span>YAML</span></button></li></ul><div id=tabs-11-content class=codetab-content><div id=tabs-11-xml-tab class=codetab-content-item><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;namespace-binding</span> <span class=na>prefix=</span><span class=s>&#34;oscal&#34;</span> <span class=na>uri=</span><span class=s>&#34;http://csrc.nist.gov/ns/oscal/1.0&#34;</span><span class=nt>/&gt;</span>
</span></span></code></pre></div></div><div id=tabs-11-json-tab class=codetab-content-item><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;namespace-bindings&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;prefix&#34;</span><span class=p>:</span> <span class=s2>&#34;oscal&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;uri&#34;</span><span class=p>:</span> <span class=s2>&#34;http://csrc.nist.gov/ns/oscal/1.0&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div></div><div id=tabs-11-yaml-tab class=codetab-content-item><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>namespace-bindings</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>prefix</span><span class=p>:</span><span class=w> </span><span class=l>oscal</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>uri</span><span class=p>:</span><span class=w> </span><span class=l>http://csrc.nist.gov/ns/oscal/1.0</span><span class=w>
</span></span></span></code></pre></div></div></div></div><h3 id=definition-context><a href=#definition-context><code>&lt;definition-context></code></a></h3><p>The <code>&lt;definition-context></code> element defines constraints that apply to a specific definition identified by name and namespace.</p><table><thead><tr><th style=text-align:left>Data</th><th style=text-align:left>Data Type</th><th style=text-align:left>Use</th><th style=text-align:left>Default Value</th></tr></thead><tbody><tr><td style=text-align:left><code>@name</code></td><td style=text-align:left><a href=/specification/datatypes/#token><code>token</code></a></td><td style=text-align:left>required</td><td style=text-align:left><em>(no default)</em></td></tr><tr><td style=text-align:left><code>@namespace</code></td><td style=text-align:left><a href=/specification/datatypes/#uri><code>uri</code></a></td><td style=text-align:left>required</td><td style=text-align:left><em>(no default)</em></td></tr><tr><td style=text-align:left><code>&lt;constraints></code></td><td style=text-align:left>(structured)</td><td style=text-align:left>required</td><td style=text-align:left><em>(no default)</em></td></tr><tr><td style=text-align:left><a href=/specification/syntax/constraints/#remarks><code>&lt;remarks></code></a></td><td style=text-align:left>(structured)</td><td style=text-align:left>0 or 1</td><td style=text-align:left><em>(no default)</em></td></tr></tbody></table><p>The <code>@name</code> attribute MUST contain the name of the target definition.</p><p>The <code>@namespace</code> attribute MUST contain the namespace URI of the Metaschema module containing the target definition.</p><div id=tabs-12 class="codetabs usa-accordion"><ul><li class=codetab><button class=usa-accordion__button aria-expanded=true aria-controls=tabs-12-xml-tab><span>XML</span></button></li><li class=codetab><button class=usa-accordion__button aria-expanded=true aria-controls=tabs-12-json-tab><span>JSON</span></button></li><li class=codetab><button class=usa-accordion__button aria-expanded=true aria-controls=tabs-12-yaml-tab><span>YAML</span></button></li></ul><div id=tabs-12-content class=codetab-content><div id=tabs-12-xml-tab class=codetab-content-item><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;definition-context</span> <span class=na>name=</span><span class=s>&#34;catalog&#34;</span>
</span></span><span class=line><span class=cl>    <span class=na>namespace=</span><span class=s>&#34;http://csrc.nist.gov/ns/oscal/1.0&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;constraints&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;expect</span> <span class=na>test=</span><span class=s>&#34;exists(metadata)&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;message&gt;</span>A catalog must have metadata.<span class=nt>&lt;/message&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/expect&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/constraints&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/definition-context&gt;</span>
</span></span></code></pre></div></div><div id=tabs-12-json-tab class=codetab-content-item><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;definition-context&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;catalog&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;namespace&#34;</span><span class=p>:</span> <span class=s2>&#34;http://csrc.nist.gov/ns/oscal/1.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;constraints&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;expect&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;test&#34;</span><span class=p>:</span> <span class=s2>&#34;exists(metadata)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;message&#34;</span><span class=p>:</span> <span class=s2>&#34;A catalog must have metadata.&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div></div><div id=tabs-12-yaml-tab class=codetab-content-item><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>definition-context</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>catalog</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>http://csrc.nist.gov/ns/oscal/1.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>constraints</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>expect</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>test</span><span class=p>:</span><span class=w> </span><span class=l>exists(metadata)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>message</span><span class=p>:</span><span class=w> </span><span class=l>A catalog must have metadata.</span><span class=w>
</span></span></span></code></pre></div></div></div></div><h3 id=context><a href=#context><code>&lt;context></code></a></h3><p>The <code>&lt;context></code> element defines a Metapath-based context for applying constraints to nodes selected by one or more Metapath expressions.</p><table><thead><tr><th style=text-align:left>Data</th><th style=text-align:left>Data Type</th><th style=text-align:left>Use</th><th style=text-align:left>Default Value</th></tr></thead><tbody><tr><td style=text-align:left><a href=/specification/syntax/constraints/#metapath><code>&lt;metapath></code></a></td><td style=text-align:left>(structured)</td><td style=text-align:left>1 to âˆž</td><td style=text-align:left><em>(no default)</em></td></tr><tr><td style=text-align:left><code>&lt;constraints></code></td><td style=text-align:left>(structured)</td><td style=text-align:left>0 or 1</td><td style=text-align:left><em>(no default)</em></td></tr><tr><td style=text-align:left><code>&lt;context></code></td><td style=text-align:left>(structured)</td><td style=text-align:left>0 to âˆž</td><td style=text-align:left><em>(no default)</em></td></tr><tr><td style=text-align:left><a href=/specification/syntax/constraints/#remarks><code>&lt;remarks></code></a></td><td style=text-align:left>(structured)</td><td style=text-align:left>0 or 1</td><td style=text-align:left><em>(no default)</em></td></tr></tbody></table><p>A <code>&lt;context></code> element MUST contain at least one <code>&lt;metapath></code> child element.</p><p>The <code>&lt;context></code> element MAY be nested to create hierarchical constraint scopes. When nested, the child context&rsquo;s Metapath expressions are evaluated relative to the parent context&rsquo;s selected nodes.</p><div id=tabs-13 class="codetabs usa-accordion"><ul><li class=codetab><button class=usa-accordion__button aria-expanded=true aria-controls=tabs-13-xml-tab><span>XML</span></button></li><li class=codetab><button class=usa-accordion__button aria-expanded=true aria-controls=tabs-13-json-tab><span>JSON</span></button></li><li class=codetab><button class=usa-accordion__button aria-expanded=true aria-controls=tabs-13-yaml-tab><span>YAML</span></button></li></ul><div id=tabs-13-content class=codetab-content><div id=tabs-13-xml-tab class=codetab-content-item><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;context&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;metapath</span> <span class=na>target=</span><span class=s>&#34;/METASCHEMA&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;constraints&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;expect</span> <span class=na>id=</span><span class=s>&#34;module-version-required&#34;</span> <span class=na>level=</span><span class=s>&#34;WARNING&#34;</span>
</span></span><span class=line><span class=cl>            <span class=na>target=</span><span class=s>&#34;.[not(@abstract) or @abstract=&#39;no&#39;]&#34;</span>
</span></span><span class=line><span class=cl>            <span class=na>test=</span><span class=s>&#34;schema-version&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;message&gt;</span>A top-level module should have a schema version.<span class=nt>&lt;/message&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/expect&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/constraints&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;context&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;metapath</span> <span class=na>target=</span><span class=s>&#34;./define-assembly&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;constraints&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;expect</span> <span class=na>test=</span><span class=s>&#34;exists(formal-name)&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/constraints&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/context&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/context&gt;</span>
</span></span></code></pre></div></div><div id=tabs-13-json-tab class=codetab-content-item><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;contexts&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;metapaths&#34;</span><span class=p>:</span> <span class=p>[{</span> <span class=nt>&#34;target&#34;</span><span class=p>:</span> <span class=s2>&#34;/METASCHEMA&#34;</span> <span class=p>}],</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;constraints&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;expect&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=s2>&#34;module-version-required&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;level&#34;</span><span class=p>:</span> <span class=s2>&#34;WARNING&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;target&#34;</span><span class=p>:</span> <span class=s2>&#34;.[not(@abstract) or @abstract=&#39;no&#39;]&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;test&#34;</span><span class=p>:</span> <span class=s2>&#34;schema-version&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;message&#34;</span><span class=p>:</span> <span class=s2>&#34;A top-level module should have a schema version.&#34;</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;contexts&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;metapaths&#34;</span><span class=p>:</span> <span class=p>[{</span> <span class=nt>&#34;target&#34;</span><span class=p>:</span> <span class=s2>&#34;./define-assembly&#34;</span> <span class=p>}],</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;constraints&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;expect&#34;</span><span class=p>:</span> <span class=p>[{</span> <span class=nt>&#34;test&#34;</span><span class=p>:</span> <span class=s2>&#34;exists(formal-name)&#34;</span> <span class=p>}]</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div></div><div id=tabs-13-yaml-tab class=codetab-content-item><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>contexts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>metapaths</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>target</span><span class=p>:</span><span class=w> </span><span class=l>/METASCHEMA</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>constraints</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>expect</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>id</span><span class=p>:</span><span class=w> </span><span class=l>module-version-required</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>level</span><span class=p>:</span><span class=w> </span><span class=l>WARNING</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>target</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;.[not(@abstract) or @abstract=&#39;no&#39;]&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>test</span><span class=p>:</span><span class=w> </span><span class=l>schema-version</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>message</span><span class=p>:</span><span class=w> </span><span class=l>A top-level module should have a schema version.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>contexts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>metapaths</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=nt>target</span><span class=p>:</span><span class=w> </span><span class=l>./define-assembly</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>constraints</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>expect</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=nt>test</span><span class=p>:</span><span class=w> </span><span class=l>exists(formal-name)</span><span class=w>
</span></span></span></code></pre></div></div></div></div><h3 id=metapath><a href=#metapath><code>&lt;metapath></code></a></h3><p>The <code>&lt;metapath></code> element specifies a <a href=/specification/syntax/metapath/>Metapath expression</a> identifying the model node(s) that the constraints will be applied to.</p><table><thead><tr><th style=text-align:left>Data</th><th style=text-align:left>Data Type</th><th style=text-align:left>Use</th><th style=text-align:left>Default Value</th></tr></thead><tbody><tr><td style=text-align:left><code>@target</code></td><td style=text-align:left><a href=/specification/syntax/metapath/>metapath</a></td><td style=text-align:left>required</td><td style=text-align:left><em>(no default)</em></td></tr></tbody></table><p>The <code>@target</code> attribute MUST contain a valid Metapath expression.</p><p>Multiple <code>&lt;metapath></code> elements within a single <code>&lt;context></code> allow constraints to apply to multiple node selections.</p><div id=tabs-14 class="codetabs usa-accordion"><ul><li class=codetab><button class=usa-accordion__button aria-expanded=true aria-controls=tabs-14-xml-tab><span>XML</span></button></li><li class=codetab><button class=usa-accordion__button aria-expanded=true aria-controls=tabs-14-json-tab><span>JSON</span></button></li><li class=codetab><button class=usa-accordion__button aria-expanded=true aria-controls=tabs-14-yaml-tab><span>YAML</span></button></li></ul><div id=tabs-14-content class=codetab-content><div id=tabs-14-xml-tab class=codetab-content-item><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;context&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;metapath</span> <span class=na>target=</span><span class=s>&#34;/METASCHEMA&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;metapath</span> <span class=na>target=</span><span class=s>&#34;/metaschema-meta-constraints&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;constraints&gt;</span>
</span></span><span class=line><span class=cl>        <span class=c>&lt;!-- Constraints apply to both root elements --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/constraints&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/context&gt;</span>
</span></span></code></pre></div></div><div id=tabs-14-json-tab class=codetab-content-item><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;metapaths&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span> <span class=nt>&#34;target&#34;</span><span class=p>:</span> <span class=s2>&#34;/METASCHEMA&#34;</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span> <span class=nt>&#34;target&#34;</span><span class=p>:</span> <span class=s2>&#34;/metaschema-meta-constraints&#34;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;constraints&#34;</span><span class=p>:</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div></div><div id=tabs-14-yaml-tab class=codetab-content-item><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>metapaths</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>target</span><span class=p>:</span><span class=w> </span><span class=l>/METASCHEMA</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>target</span><span class=p>:</span><span class=w> </span><span class=l>/metaschema-meta-constraints</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>constraints</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span></code></pre></div></div></div></div><h3 id=external-constraint-processing><a href=#external-constraint-processing>External Constraint Processing</a></h3><p>When processing external constraints, a Metaschema processor MUST:</p><ol><li>Resolve all <code>&lt;import></code> references and load the imported constraint definitions.</li><li>Resolve namespace bindings from <code>&lt;namespace-binding></code> elements.</li><li>Process <code>&lt;definition-context></code> constraints, if present, by matching the definition by name and namespace.</li><li>For each <code>&lt;context></code> element:<ul><li>Evaluate the <code>&lt;metapath></code> expressions to identify target nodes.</li><li>Apply the constraints defined within the context to the identified nodes.</li><li>Process nested <code>&lt;context></code> elements recursively, with inner context Metapath expressions evaluated relative to the outer context&rsquo;s selected nodes.</li></ul></li></ol><p>External constraints MUST be applied after internal constraints according to the <a href=/specification/syntax/constraints/#constraint-processing>declaration order</a> rules defined earlier in this specification.</p></main></div></div><p class="font-sans-sm text-center" style="margin:1.5rem auto;clear:both">This page was last updated on December 14, 2025. <a href=https://github.com/metaschema-framework/metaschema/tree/master/website/content/specification/syntax/constraints.md>Improve this Page.</a></p><script type=text/javascript src=/module/hugo-uswds/js/uswds.min.js></script><script>$(document).ready(function(){$('a[href*="//"]:not([href*="https://framework.metaschema.dev/"]):not([href^="#"]):not([href^="/"])').addClass("usa-link usa-link--external")})</script></body></html>